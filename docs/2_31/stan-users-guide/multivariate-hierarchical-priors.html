<!DOCTYPE html>
<html lang="" xml:lang="">
<head>
<link rel="canonical" href="https://mc-stan.org/docs/stan-users-guide/regression.html#multivariate-hierarchical-priors.section" />
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1.13 Multivariate priors for hierarchical models | Stan User’s Guide</title>
  <meta name="description" content="Stan user’s guide with examples and programming techniques." />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="1.13 Multivariate priors for hierarchical models | Stan User’s Guide" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/img/logo-tm.pdf" />
  <meta property="og:description" content="Stan user’s guide with examples and programming techniques." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1.13 Multivariate priors for hierarchical models | Stan User’s Guide" />
  
  <meta name="twitter:description" content="Stan user’s guide with examples and programming techniques." />
  <meta name="twitter:image" content="/img/logo-tm.pdf" />

<meta name="author" content="Stan Development Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="priors-for-identification.html"/>
<link rel="next" href="prediction-forecasting-and-backcasting.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="stan-manual.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li style="font-size:110%; font-weight:400; font-family: Verdana, Helvetica, sans; line-height:1.4; margin: 0.5em 0 0 1em"><a href="https://mc-stan.org/docs/stan-users-guide/index.html" style="color:#4183C4">Stan User's Guide</a></li>

<li class="divider"></li>
<li><a href="index.html#overview"><i style="font-size: 110%; padding:1.5em 0 0 0; color:#990017;">Overview</i></a></li>
<li><a href="example-models.html#example-models.part"><i style="font-size: 110%; color:#990017;">Part 1. Example Models</i></a></li>
<li class="chapter" data-level="1" data-path="regression-models.html"><a href="regression-models.html"><i class="fa fa-check"></i><b>1</b> Regression Models</a>
<ul>
<li class="chapter" data-level="1.1" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>1.1</b> Linear regression</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#vectorization.section"><i class="fa fa-check"></i>Matrix notation and vectorization</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="QR-reparameterization.html"><a href="QR-reparameterization.html"><i class="fa fa-check"></i><b>1.2</b> The QR reparameterization</a></li>
<li class="chapter" data-level="1.3" data-path="regression-priors.html"><a href="regression-priors.html"><i class="fa fa-check"></i><b>1.3</b> Priors for coefficients and scales</a></li>
<li class="chapter" data-level="1.4" data-path="robust-noise-models.html"><a href="robust-noise-models.html"><i class="fa fa-check"></i><b>1.4</b> Robust noise models</a></li>
<li class="chapter" data-level="1.5" data-path="logistic-probit-regression.html"><a href="logistic-probit-regression.html"><i class="fa fa-check"></i><b>1.5</b> Logistic and probit regression</a></li>
<li class="chapter" data-level="1.6" data-path="multi-logit.html"><a href="multi-logit.html"><i class="fa fa-check"></i><b>1.6</b> Multi-logit regression</a>
<ul>
<li class="chapter" data-level="" data-path="multi-logit.html"><a href="multi-logit.html#identifiability"><i class="fa fa-check"></i>Identifiability</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="parameterizing-centered-vectors.html"><a href="parameterizing-centered-vectors.html"><i class="fa fa-check"></i><b>1.7</b> Parameterizing centered vectors</a>
<ul>
<li><a href="parameterizing-centered-vectors.html#k-1-degrees-of-freedom"><span class="math inline">\(K-1\)</span> degrees of freedom</a></li>
<li class="chapter" data-level="" data-path="parameterizing-centered-vectors.html"><a href="parameterizing-centered-vectors.html#qr-decomposition"><i class="fa fa-check"></i>QR decomposition</a></li>
<li class="chapter" data-level="" data-path="parameterizing-centered-vectors.html"><a href="parameterizing-centered-vectors.html#translated-and-scaled-simplex"><i class="fa fa-check"></i>Translated and scaled simplex</a></li>
<li class="chapter" data-level="" data-path="parameterizing-centered-vectors.html"><a href="parameterizing-centered-vectors.html#soft-centering"><i class="fa fa-check"></i>Soft centering</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="ordered-logistic.html"><a href="ordered-logistic.html"><i class="fa fa-check"></i><b>1.8</b> Ordered logistic and probit regression</a>
<ul>
<li class="chapter" data-level="" data-path="ordered-logistic.html"><a href="ordered-logistic.html#ordered-logistic-regression"><i class="fa fa-check"></i>Ordered logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="hierarchical-logistic-regression.html"><a href="hierarchical-logistic-regression.html"><i class="fa fa-check"></i><b>1.9</b> Hierarchical logistic regression</a></li>
<li class="chapter" data-level="1.10" data-path="hierarchical-priors.html"><a href="hierarchical-priors.html"><i class="fa fa-check"></i><b>1.10</b> Hierarchical priors</a>
<ul>
<li class="chapter" data-level="" data-path="hierarchical-priors.html"><a href="hierarchical-priors.html#boundary-avoiding-priors-for-mle-in-hierarchical-models"><i class="fa fa-check"></i>Boundary-avoiding priors for MLE in hierarchical models</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="item-response-models.html"><a href="item-response-models.html"><i class="fa fa-check"></i><b>1.11</b> Item-response theory models</a>
<ul>
<li class="chapter" data-level="" data-path="item-response-models.html"><a href="item-response-models.html#data-declaration-with-missingness"><i class="fa fa-check"></i>Data declaration with missingness</a></li>
<li class="chapter" data-level="" data-path="item-response-models.html"><a href="item-response-models.html#pl-rasch-model"><i class="fa fa-check"></i>1PL (Rasch) model</a></li>
<li class="chapter" data-level="" data-path="item-response-models.html"><a href="item-response-models.html#multilevel-2pl-model"><i class="fa fa-check"></i>Multilevel 2PL model</a></li>
</ul></li>
<li class="chapter" data-level="1.12" data-path="priors-for-identification.html"><a href="priors-for-identification.html"><i class="fa fa-check"></i><b>1.12</b> Priors for identifiability</a>
<ul>
<li class="chapter" data-level="" data-path="priors-for-identification.html"><a href="priors-for-identification.html#location-and-scale-invariance"><i class="fa fa-check"></i>Location and scale invariance</a></li>
<li class="chapter" data-level="" data-path="priors-for-identification.html"><a href="priors-for-identification.html#collinearity"><i class="fa fa-check"></i>Collinearity</a></li>
<li class="chapter" data-level="" data-path="priors-for-identification.html"><a href="priors-for-identification.html#separability"><i class="fa fa-check"></i>Separability</a></li>
</ul></li>
<li class="chapter" data-level="1.13" data-path="multivariate-hierarchical-priors.html"><a href="multivariate-hierarchical-priors.html"><i class="fa fa-check"></i><b>1.13</b> Multivariate priors for hierarchical models</a>
<ul>
<li class="chapter" data-level="" data-path="multivariate-hierarchical-priors.html"><a href="multivariate-hierarchical-priors.html#multivariate-regression-example"><i class="fa fa-check"></i>Multivariate regression example</a></li>
</ul></li>
<li class="chapter" data-level="1.14" data-path="prediction-forecasting-and-backcasting.html"><a href="prediction-forecasting-and-backcasting.html"><i class="fa fa-check"></i><b>1.14</b> Prediction, forecasting, and backcasting</a>
<ul>
<li class="chapter" data-level="" data-path="prediction-forecasting-and-backcasting.html"><a href="prediction-forecasting-and-backcasting.html#programming-predictions"><i class="fa fa-check"></i>Programming predictions</a></li>
<li class="chapter" data-level="" data-path="prediction-forecasting-and-backcasting.html"><a href="prediction-forecasting-and-backcasting.html#predictions-as-generated-quantities"><i class="fa fa-check"></i>Predictions as generated quantities</a></li>
</ul></li>
<li class="chapter" data-level="1.15" data-path="multivariate-outcomes.html"><a href="multivariate-outcomes.html"><i class="fa fa-check"></i><b>1.15</b> Multivariate outcomes</a>
<ul>
<li class="chapter" data-level="" data-path="multivariate-outcomes.html"><a href="multivariate-outcomes.html#seemingly-unrelated-regressions"><i class="fa fa-check"></i>Seemingly unrelated regressions</a></li>
<li class="chapter" data-level="" data-path="multivariate-outcomes.html"><a href="multivariate-outcomes.html#multivariate-probit-regression"><i class="fa fa-check"></i>Multivariate probit regression</a></li>
</ul></li>
<li class="chapter" data-level="1.16" data-path="applications-of-pseudorandom-number-generation.html"><a href="applications-of-pseudorandom-number-generation.html"><i class="fa fa-check"></i><b>1.16</b> Applications of pseudorandom number generation</a>
<ul>
<li class="chapter" data-level="" data-path="applications-of-pseudorandom-number-generation.html"><a href="applications-of-pseudorandom-number-generation.html#prediction"><i class="fa fa-check"></i>Prediction</a></li>
<li class="chapter" data-level="" data-path="applications-of-pseudorandom-number-generation.html"><a href="applications-of-pseudorandom-number-generation.html#posterior-predictive-checks"><i class="fa fa-check"></i>Posterior predictive checks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>2</b> Time-Series Models</a>
<ul>
<li class="chapter" data-level="2.1" data-path="autoregressive.html"><a href="autoregressive.html"><i class="fa fa-check"></i><b>2.1</b> Autoregressive models</a>
<ul>
<li class="chapter" data-level="" data-path="autoregressive.html"><a href="autoregressive.html#ar1-models"><i class="fa fa-check"></i>AR(1) models</a></li>
<li class="chapter" data-level="" data-path="autoregressive.html"><a href="autoregressive.html#extensions-to-the-ar1-model"><i class="fa fa-check"></i>Extensions to the AR(1) model</a></li>
<li class="chapter" data-level="" data-path="autoregressive.html"><a href="autoregressive.html#ar2-models"><i class="fa fa-check"></i>AR(2) models</a></li>
<li><a href="autoregressive.html#ark-models">AR(<span class="math inline">\(K\)</span>) models</a></li>
<li class="chapter" data-level="" data-path="autoregressive.html"><a href="autoregressive.html#arch1-models"><i class="fa fa-check"></i>ARCH(1) models</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="modeling-temporal-heteroscedasticity.html"><a href="modeling-temporal-heteroscedasticity.html"><i class="fa fa-check"></i><b>2.2</b> Modeling temporal heteroscedasticity</a>
<ul>
<li class="chapter" data-level="" data-path="modeling-temporal-heteroscedasticity.html"><a href="modeling-temporal-heteroscedasticity.html#garch11-models"><i class="fa fa-check"></i>GARCH(1,1) models</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="moving-average-models.html"><a href="moving-average-models.html"><i class="fa fa-check"></i><b>2.3</b> Moving average models</a>
<ul>
<li class="chapter" data-level="" data-path="moving-average-models.html"><a href="moving-average-models.html#ma2-example"><i class="fa fa-check"></i>MA(2) example</a></li>
<li class="chapter" data-level="" data-path="moving-average-models.html"><a href="moving-average-models.html#vectorized-maq-model"><i class="fa fa-check"></i>Vectorized MA(Q) model</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="autoregressive-moving-average-models.html"><a href="autoregressive-moving-average-models.html"><i class="fa fa-check"></i><b>2.4</b> Autoregressive moving average models</a>
<ul>
<li class="chapter" data-level="" data-path="autoregressive-moving-average-models.html"><a href="autoregressive-moving-average-models.html#identifiability-and-stationarity"><i class="fa fa-check"></i>Identifiability and stationarity</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="stochastic-volatility-models.html"><a href="stochastic-volatility-models.html"><i class="fa fa-check"></i><b>2.5</b> Stochastic volatility models</a></li>
<li class="chapter" data-level="2.6" data-path="hmms.html"><a href="hmms.html"><i class="fa fa-check"></i><b>2.6</b> Hidden Markov models</a>
<ul>
<li class="chapter" data-level="" data-path="hmms.html"><a href="hmms.html#supervised-parameter-estimation"><i class="fa fa-check"></i>Supervised parameter estimation</a></li>
<li class="chapter" data-level="" data-path="hmms.html"><a href="hmms.html#start-state-and-end-state-probabilities"><i class="fa fa-check"></i>Start-state and end-state probabilities</a></li>
<li class="chapter" data-level="" data-path="hmms.html"><a href="hmms.html#calculating-sufficient-statistics"><i class="fa fa-check"></i>Calculating sufficient statistics</a></li>
<li class="chapter" data-level="" data-path="hmms.html"><a href="hmms.html#analytic-posterior"><i class="fa fa-check"></i>Analytic posterior</a></li>
<li class="chapter" data-level="" data-path="hmms.html"><a href="hmms.html#semisupervised-estimation"><i class="fa fa-check"></i>Semisupervised estimation</a></li>
<li class="chapter" data-level="" data-path="hmms.html"><a href="hmms.html#predictive-inference"><i class="fa fa-check"></i>Predictive inference</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="missing-data-and-partially-known-parameters.html"><a href="missing-data-and-partially-known-parameters.html"><i class="fa fa-check"></i><b>3</b> Missing Data and Partially Known Parameters</a>
<ul>
<li class="chapter" data-level="3.1" data-path="missing-data.html"><a href="missing-data.html"><i class="fa fa-check"></i><b>3.1</b> Missing data</a></li>
<li class="chapter" data-level="3.2" data-path="partially-known-parameters.html"><a href="partially-known-parameters.html"><i class="fa fa-check"></i><b>3.2</b> Partially known parameters</a></li>
<li class="chapter" data-level="3.3" data-path="sliced-missing-data.html"><a href="sliced-missing-data.html"><i class="fa fa-check"></i><b>3.3</b> Sliced missing data</a></li>
<li class="chapter" data-level="3.4" data-path="loading-matrix-for-factor-analysis.html"><a href="loading-matrix-for-factor-analysis.html"><i class="fa fa-check"></i><b>3.4</b> Loading matrix for factor analysis</a></li>
<li class="chapter" data-level="3.5" data-path="missing-multivariate-data.html"><a href="missing-multivariate-data.html"><i class="fa fa-check"></i><b>3.5</b> Missing multivariate data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="truncated-or-censored-data.html"><a href="truncated-or-censored-data.html"><i class="fa fa-check"></i><b>4</b> Truncated or Censored Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="truncation.html"><a href="truncation.html"><i class="fa fa-check"></i><b>4.1</b> Truncated distributions</a></li>
<li class="chapter" data-level="4.2" data-path="truncated-data.html"><a href="truncated-data.html"><i class="fa fa-check"></i><b>4.2</b> Truncated data</a>
<ul>
<li class="chapter" data-level="" data-path="truncated-data.html"><a href="truncated-data.html#constraints-and-out-of-bounds-returns"><i class="fa fa-check"></i>Constraints and out-of-bounds returns</a></li>
<li class="chapter" data-level="" data-path="truncated-data.html"><a href="truncated-data.html#unknown-truncation-points"><i class="fa fa-check"></i>Unknown truncation points</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="censored-data.html"><a href="censored-data.html"><i class="fa fa-check"></i><b>4.3</b> Censored data</a>
<ul>
<li class="chapter" data-level="" data-path="censored-data.html"><a href="censored-data.html#estimating-censored-values"><i class="fa fa-check"></i>Estimating censored values</a></li>
<li class="chapter" data-level="" data-path="censored-data.html"><a href="censored-data.html#integrating-out-censored-values"><i class="fa fa-check"></i>Integrating out censored values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mixture-modeling.html"><a href="mixture-modeling.html"><i class="fa fa-check"></i><b>5</b> Finite Mixtures</a>
<ul>
<li class="chapter" data-level="5.1" data-path="clustering-mixture.html"><a href="clustering-mixture.html"><i class="fa fa-check"></i><b>5.1</b> Relation to clustering</a></li>
<li class="chapter" data-level="5.2" data-path="latent-discrete-parameterization.html"><a href="latent-discrete-parameterization.html"><i class="fa fa-check"></i><b>5.2</b> Latent discrete parameterization</a></li>
<li class="chapter" data-level="5.3" data-path="summing-out-the-responsibility-parameter.html"><a href="summing-out-the-responsibility-parameter.html"><i class="fa fa-check"></i><b>5.3</b> Summing out the responsibility parameter</a>
<ul>
<li class="chapter" data-level="" data-path="summing-out-the-responsibility-parameter.html"><a href="summing-out-the-responsibility-parameter.html#log-sum-of-exponentials-linear-sums-on-the-log-scale"><i class="fa fa-check"></i>Log sum of exponentials: linear Sums on the log scale</a></li>
<li class="chapter" data-level="" data-path="summing-out-the-responsibility-parameter.html"><a href="summing-out-the-responsibility-parameter.html#dropping-uniform-mixture-ratios"><i class="fa fa-check"></i>Dropping uniform mixture ratios</a></li>
<li class="chapter" data-level="" data-path="summing-out-the-responsibility-parameter.html"><a href="summing-out-the-responsibility-parameter.html#recovering-posterior-mixture-proportions"><i class="fa fa-check"></i>Recovering posterior mixture proportions</a></li>
<li class="chapter" data-level="" data-path="summing-out-the-responsibility-parameter.html"><a href="summing-out-the-responsibility-parameter.html#estimating-parameters-of-a-mixture"><i class="fa fa-check"></i>Estimating parameters of a mixture</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="vectorizing-mixtures.html"><a href="vectorizing-mixtures.html"><i class="fa fa-check"></i><b>5.4</b> Vectorizing mixtures</a></li>
<li class="chapter" data-level="5.5" data-path="mixture-inference.html"><a href="mixture-inference.html"><i class="fa fa-check"></i><b>5.5</b> Inferences supported by mixtures</a>
<ul>
<li class="chapter" data-level="" data-path="mixture-inference.html"><a href="mixture-inference.html#mixtures-with-unidentifiable-components"><i class="fa fa-check"></i>Mixtures with unidentifiable components</a></li>
<li class="chapter" data-level="" data-path="mixture-inference.html"><a href="mixture-inference.html#inference-under-label-switching"><i class="fa fa-check"></i>Inference under label switching</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="zero-inflated.html"><a href="zero-inflated.html"><i class="fa fa-check"></i><b>5.6</b> Zero-inflated and hurdle models</a>
<ul>
<li class="chapter" data-level="" data-path="zero-inflated.html"><a href="zero-inflated.html#zero-inflation"><i class="fa fa-check"></i>Zero inflation</a></li>
<li class="chapter" data-level="" data-path="zero-inflated.html"><a href="zero-inflated.html#hurdle-models"><i class="fa fa-check"></i>Hurdle models</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="priors-and-effective-data-size-in-mixture-models.html"><a href="priors-and-effective-data-size-in-mixture-models.html"><i class="fa fa-check"></i><b>5.7</b> Priors and effective data size in mixture models</a>
<ul>
<li class="chapter" data-level="" data-path="priors-and-effective-data-size-in-mixture-models.html"><a href="priors-and-effective-data-size-in-mixture-models.html#comparison-to-model-averaging"><i class="fa fa-check"></i>Comparison to model averaging</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="measurement-error-and-meta-analysis.html"><a href="measurement-error-and-meta-analysis.html"><i class="fa fa-check"></i><b>6</b> Measurement Error and Meta-Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="bayesian-measurement-error-model.html"><a href="bayesian-measurement-error-model.html"><i class="fa fa-check"></i><b>6.1</b> Bayesian measurement error model</a>
<ul>
<li class="chapter" data-level="" data-path="bayesian-measurement-error-model.html"><a href="bayesian-measurement-error-model.html#regression-with-measurement-error"><i class="fa fa-check"></i>Regression with measurement error</a></li>
<li class="chapter" data-level="" data-path="bayesian-measurement-error-model.html"><a href="bayesian-measurement-error-model.html#rounding"><i class="fa fa-check"></i>Rounding</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="meta-analysis.html"><a href="meta-analysis.html"><i class="fa fa-check"></i><b>6.2</b> Meta-analysis</a>
<ul>
<li class="chapter" data-level="" data-path="meta-analysis.html"><a href="meta-analysis.html#treatment-effects-in-controlled-studies"><i class="fa fa-check"></i>Treatment effects in controlled studies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="latent-discrete.html"><a href="latent-discrete.html"><i class="fa fa-check"></i><b>7</b> Latent Discrete Parameters</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rao-blackwell.html"><a href="rao-blackwell.html"><i class="fa fa-check"></i><b>7.1</b> The benefits of marginalization</a></li>
<li class="chapter" data-level="7.2" data-path="change-point.html"><a href="change-point.html"><i class="fa fa-check"></i><b>7.2</b> Change point models</a>
<ul>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#model-with-latent-discrete-parameter"><i class="fa fa-check"></i>Model with latent discrete parameter</a></li>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#marginalizing-out-the-discrete-parameter"><i class="fa fa-check"></i>Marginalizing out the discrete parameter</a></li>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#coding-the-model-in-stan-1"><i class="fa fa-check"></i>Coding the model in Stan</a></li>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#fitting-the-model-with-mcmc"><i class="fa fa-check"></i>Fitting the model with MCMC</a></li>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#posterior-distribution-of-the-discrete-change-point"><i class="fa fa-check"></i>Posterior distribution of the discrete change point</a></li>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#discrete-sampling"><i class="fa fa-check"></i>Discrete sampling</a></li>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#posterior-covariance"><i class="fa fa-check"></i>Posterior covariance</a></li>
<li class="chapter" data-level="" data-path="change-point.html"><a href="change-point.html#multiple-change-points"><i class="fa fa-check"></i>Multiple change points</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="mark-recapture-models.html"><a href="mark-recapture-models.html"><i class="fa fa-check"></i><b>7.3</b> Mark-recapture models</a>
<ul>
<li class="chapter" data-level="" data-path="mark-recapture-models.html"><a href="mark-recapture-models.html#simple-mark-recapture-model"><i class="fa fa-check"></i>Simple mark-recapture model</a></li>
<li class="chapter" data-level="" data-path="mark-recapture-models.html"><a href="mark-recapture-models.html#cormack-jolly-seber-with-discrete-parameter"><i class="fa fa-check"></i>Cormack-Jolly-Seber with discrete parameter</a></li>
<li class="chapter" data-level="" data-path="mark-recapture-models.html"><a href="mark-recapture-models.html#collective-cormack-jolly-seber-model"><i class="fa fa-check"></i>Collective Cormack-Jolly-Seber model</a></li>
<li class="chapter" data-level="" data-path="mark-recapture-models.html"><a href="mark-recapture-models.html#individual-cormack-jolly-seber-model"><i class="fa fa-check"></i>Individual Cormack-Jolly-Seber model</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-coding-and-diagnostic-accuracy-models.html"><a href="data-coding-and-diagnostic-accuracy-models.html"><i class="fa fa-check"></i><b>7.4</b> Data coding and diagnostic accuracy models</a>
<ul>
<li class="chapter" data-level="" data-path="data-coding-and-diagnostic-accuracy-models.html"><a href="data-coding-and-diagnostic-accuracy-models.html#diagnostic-accuracy"><i class="fa fa-check"></i>Diagnostic accuracy</a></li>
<li class="chapter" data-level="" data-path="data-coding-and-diagnostic-accuracy-models.html"><a href="data-coding-and-diagnostic-accuracy-models.html#data-coding"><i class="fa fa-check"></i>Data coding</a></li>
<li class="chapter" data-level="" data-path="data-coding-and-diagnostic-accuracy-models.html"><a href="data-coding-and-diagnostic-accuracy-models.html#noisy-categorical-measurement-model"><i class="fa fa-check"></i>Noisy categorical measurement model</a></li>
<li class="chapter" data-level="" data-path="data-coding-and-diagnostic-accuracy-models.html"><a href="data-coding-and-diagnostic-accuracy-models.html#model-parameters"><i class="fa fa-check"></i>Model parameters</a></li>
<li class="chapter" data-level="" data-path="data-coding-and-diagnostic-accuracy-models.html"><a href="data-coding-and-diagnostic-accuracy-models.html#noisy-measurement-model"><i class="fa fa-check"></i>Noisy measurement model</a></li>
<li class="chapter" data-level="" data-path="data-coding-and-diagnostic-accuracy-models.html"><a href="data-coding-and-diagnostic-accuracy-models.html#stan-implementation"><i class="fa fa-check"></i>Stan implementation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sparse-ragged.html"><a href="sparse-ragged.html"><i class="fa fa-check"></i><b>8</b> Sparse and Ragged Data Structures</a>
<ul>
<li class="chapter" data-level="8.1" data-path="sparse-data-structures.html"><a href="sparse-data-structures.html"><i class="fa fa-check"></i><b>8.1</b> Sparse data structures</a></li>
<li class="chapter" data-level="8.2" data-path="ragged-data-structs.html"><a href="ragged-data-structs.html"><i class="fa fa-check"></i><b>8.2</b> Ragged data structures</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>9</b> Clustering Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="relation-to-finite-mixture-models.html"><a href="relation-to-finite-mixture-models.html"><i class="fa fa-check"></i><b>9.1</b> Relation to finite mixture models</a></li>
<li class="chapter" data-level="9.2" data-path="soft-k-means.html"><a href="soft-k-means.html"><i class="fa fa-check"></i><b>9.2</b> Soft <em>K</em>-means</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="soft-k-means.html"><a href="soft-k-means.html#geometric-hard-k-means-clustering"><i class="fa fa-check"></i><b>9.2.1</b> Geometric hard <em>K</em>-means clustering</a></li>
<li class="chapter" data-level="9.2.2" data-path="soft-k-means.html"><a href="soft-k-means.html#soft-k-means-clustering"><i class="fa fa-check"></i><b>9.2.2</b> Soft <em>K</em>-means clustering</a></li>
<li><a href="soft-k-means.html#stan-implementation-of-soft-k-means">Stan implementation of soft <em>K</em>-means</a></li>
<li><a href="soft-k-means.html#generalizing-soft-k-means">Generalizing soft <em>K</em>-means</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="the-difficulty-of-bayesian-inference-for-clustering.html"><a href="the-difficulty-of-bayesian-inference-for-clustering.html"><i class="fa fa-check"></i><b>9.3</b> The difficulty of Bayesian inference for clustering</a>
<ul>
<li class="chapter" data-level="" data-path="the-difficulty-of-bayesian-inference-for-clustering.html"><a href="the-difficulty-of-bayesian-inference-for-clustering.html#non-identifiability"><i class="fa fa-check"></i>Non-identifiability</a></li>
<li class="chapter" data-level="" data-path="the-difficulty-of-bayesian-inference-for-clustering.html"><a href="the-difficulty-of-bayesian-inference-for-clustering.html#multimodality"><i class="fa fa-check"></i>Multimodality</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="naive-bayes-classification-and-clustering.html"><a href="naive-bayes-classification-and-clustering.html"><i class="fa fa-check"></i><b>9.4</b> Naive Bayes classification and clustering</a>
<ul>
<li class="chapter" data-level="" data-path="naive-bayes-classification-and-clustering.html"><a href="naive-bayes-classification-and-clustering.html#coding-ragged-arrays"><i class="fa fa-check"></i>Coding ragged arrays</a></li>
<li class="chapter" data-level="" data-path="naive-bayes-classification-and-clustering.html"><a href="naive-bayes-classification-and-clustering.html#estimation-with-category-labeled-training-data"><i class="fa fa-check"></i>Estimation with category-labeled training data</a></li>
<li class="chapter" data-level="" data-path="naive-bayes-classification-and-clustering.html"><a href="naive-bayes-classification-and-clustering.html#estimation-without-category-labeled-training-data"><i class="fa fa-check"></i>Estimation without category-labeled training data</a></li>
<li class="chapter" data-level="" data-path="naive-bayes-classification-and-clustering.html"><a href="naive-bayes-classification-and-clustering.html#full-bayesian-inference-for-naive-bayes"><i class="fa fa-check"></i>Full Bayesian inference for naive Bayes</a></li>
<li class="chapter" data-level="" data-path="naive-bayes-classification-and-clustering.html"><a href="naive-bayes-classification-and-clustering.html#prediction-without-model-updates"><i class="fa fa-check"></i>Prediction without model updates</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="latent-dirichlet-allocation.html"><a href="latent-dirichlet-allocation.html"><i class="fa fa-check"></i><b>9.5</b> Latent Dirichlet allocation</a>
<ul>
<li class="chapter" data-level="" data-path="latent-dirichlet-allocation.html"><a href="latent-dirichlet-allocation.html#the-lda-model"><i class="fa fa-check"></i>The LDA Model</a></li>
<li class="chapter" data-level="" data-path="latent-dirichlet-allocation.html"><a href="latent-dirichlet-allocation.html#summing-out-the-discrete-parameters"><i class="fa fa-check"></i>Summing out the discrete parameters</a></li>
<li class="chapter" data-level="" data-path="latent-dirichlet-allocation.html"><a href="latent-dirichlet-allocation.html#implementation-of-lda"><i class="fa fa-check"></i>Implementation of LDA</a></li>
<li class="chapter" data-level="" data-path="latent-dirichlet-allocation.html"><a href="latent-dirichlet-allocation.html#correlated-topic-model"><i class="fa fa-check"></i>Correlated topic model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gaussian-processes.html"><a href="gaussian-processes.html"><i class="fa fa-check"></i><b>10</b> Gaussian Processes</a>
<ul>
<li class="chapter" data-level="10.1" data-path="gaussian-process-regression.html"><a href="gaussian-process-regression.html"><i class="fa fa-check"></i><b>10.1</b> Gaussian process regression</a></li>
<li class="chapter" data-level="10.2" data-path="simulating-from-a-gaussian-process.html"><a href="simulating-from-a-gaussian-process.html"><i class="fa fa-check"></i><b>10.2</b> Simulating from a Gaussian process</a>
<ul>
<li class="chapter" data-level="" data-path="simulating-from-a-gaussian-process.html"><a href="simulating-from-a-gaussian-process.html#multivariate-inputs"><i class="fa fa-check"></i>Multivariate inputs</a></li>
<li class="chapter" data-level="" data-path="simulating-from-a-gaussian-process.html"><a href="simulating-from-a-gaussian-process.html#cholesky-factored-and-transformed-implementation"><i class="fa fa-check"></i>Cholesky factored and transformed implementation</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="fit-gp.html"><a href="fit-gp.html"><i class="fa fa-check"></i><b>10.3</b> Fitting a Gaussian process</a>
<ul>
<li class="chapter" data-level="" data-path="fit-gp.html"><a href="fit-gp.html#gp-with-a-normal-outcome"><i class="fa fa-check"></i>GP with a normal outcome</a></li>
<li class="chapter" data-level="" data-path="fit-gp.html"><a href="fit-gp.html#discrete-outcomes-with-gaussian-processes"><i class="fa fa-check"></i>Discrete outcomes with Gaussian processes</a></li>
<li class="chapter" data-level="" data-path="fit-gp.html"><a href="fit-gp.html#automatic-relevance-determination"><i class="fa fa-check"></i>Automatic relevance determination</a></li>
<li class="chapter" data-level="10.3.1" data-path="fit-gp.html"><a href="fit-gp.html#priors-gp.section"><i class="fa fa-check"></i><b>10.3.1</b> Priors for Gaussian process parameters</a></li>
<li class="chapter" data-level="" data-path="fit-gp.html"><a href="fit-gp.html#predictive-inference-with-a-gaussian-process"><i class="fa fa-check"></i>Predictive inference with a Gaussian process</a></li>
<li class="chapter" data-level="" data-path="fit-gp.html"><a href="fit-gp.html#multiple-output-gaussian-processes"><i class="fa fa-check"></i>Multiple-output Gaussian processes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="directions-rotations-and-hyperspheres.html"><a href="directions-rotations-and-hyperspheres.html"><i class="fa fa-check"></i><b>11</b> Directions, Rotations, and Hyperspheres</a>
<ul>
<li class="chapter" data-level="11.1" data-path="unit-vectors.html"><a href="unit-vectors.html"><i class="fa fa-check"></i><b>11.1</b> Unit vectors</a></li>
<li class="chapter" data-level="11.2" data-path="circles-spheres-and-hyperspheres.html"><a href="circles-spheres-and-hyperspheres.html"><i class="fa fa-check"></i><b>11.2</b> Circles, spheres, and hyperspheres</a></li>
<li class="chapter" data-level="11.3" data-path="transforming-to-unconstrained-parameters.html"><a href="transforming-to-unconstrained-parameters.html"><i class="fa fa-check"></i><b>11.3</b> Transforming to unconstrained parameters</a></li>
<li class="chapter" data-level="11.4" data-path="unit-vectors-and-rotations.html"><a href="unit-vectors-and-rotations.html"><i class="fa fa-check"></i><b>11.4</b> Unit vectors and rotations</a>
<ul>
<li class="chapter" data-level="" data-path="unit-vectors-and-rotations.html"><a href="unit-vectors-and-rotations.html#angles-from-unit-vectors"><i class="fa fa-check"></i>Angles from unit vectors</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="circular-representations-of-days-and-years.html"><a href="circular-representations-of-days-and-years.html"><i class="fa fa-check"></i><b>11.5</b> Circular representations of days and years</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="algebra-solver.html"><a href="algebra-solver.html"><i class="fa fa-check"></i><b>12</b> Solving Algebraic Equations</a>
<ul>
<li class="chapter" data-level="12.1" data-path="example-system-of-nonlinear-algebraic-equations.html"><a href="example-system-of-nonlinear-algebraic-equations.html"><i class="fa fa-check"></i><b>12.1</b> Example: system of nonlinear algebraic equations</a></li>
<li class="chapter" data-level="12.2" data-path="coding-an-algebraic-system.html"><a href="coding-an-algebraic-system.html"><i class="fa fa-check"></i><b>12.2</b> Coding an algebraic system</a></li>
<li class="chapter" data-level="12.3" data-path="calling-the-algebraic-solver.html"><a href="calling-the-algebraic-solver.html"><i class="fa fa-check"></i><b>12.3</b> Calling the algebraic solver</a>
<ul>
<li class="chapter" data-level="" data-path="calling-the-algebraic-solver.html"><a href="calling-the-algebraic-solver.html#data-versus-parameters"><i class="fa fa-check"></i>Data versus parameters</a></li>
<li class="chapter" data-level="" data-path="calling-the-algebraic-solver.html"><a href="calling-the-algebraic-solver.html#length-of-the-algebraic-function-and-of-the-vector-of-unknowns"><i class="fa fa-check"></i>Length of the algebraic function and of the vector of unknowns</a></li>
<li class="chapter" data-level="" data-path="calling-the-algebraic-solver.html"><a href="calling-the-algebraic-solver.html#pathological-solutions"><i class="fa fa-check"></i>Pathological solutions</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="algebra-control.html"><a href="algebra-control.html"><i class="fa fa-check"></i><b>12.4</b> Control parameters for the algebraic solver</a>
<ul>
<li class="chapter" data-level="" data-path="algebra-control.html"><a href="algebra-control.html#tolerance"><i class="fa fa-check"></i>Tolerance</a></li>
<li class="chapter" data-level="" data-path="algebra-control.html"><a href="algebra-control.html#maximum-number-of-steps"><i class="fa fa-check"></i>Maximum number of steps</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="ode-solver.html"><a href="ode-solver.html"><i class="fa fa-check"></i><b>13</b> Ordinary Differential Equations</a>
<ul>
<li class="chapter" data-level="13.1" data-path="notation.html"><a href="notation.html"><i class="fa fa-check"></i><b>13.1</b> Notation</a></li>
<li class="chapter" data-level="13.2" data-path="example-simple-harmonic-oscillator.html"><a href="example-simple-harmonic-oscillator.html"><i class="fa fa-check"></i><b>13.2</b> Example: simple harmonic oscillator</a></li>
<li class="chapter" data-level="13.3" data-path="coding-the-ode-system-function.html"><a href="coding-the-ode-system-function.html"><i class="fa fa-check"></i><b>13.3</b> Coding the ODE system function</a>
<ul>
<li class="chapter" data-level="" data-path="coding-the-ode-system-function.html"><a href="coding-the-ode-system-function.html#strict-signature-1"><i class="fa fa-check"></i>Strict signature</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="measurement-error-models.html"><a href="measurement-error-models.html"><i class="fa fa-check"></i><b>13.4</b> Measurement error models</a>
<ul>
<li class="chapter" data-level="" data-path="measurement-error-models.html"><a href="measurement-error-models.html#simulating-noisy-measurements"><i class="fa fa-check"></i>Simulating noisy measurements</a></li>
<li class="chapter" data-level="" data-path="measurement-error-models.html"><a href="measurement-error-models.html#estimating-system-parameters-and-initial-state"><i class="fa fa-check"></i>Estimating system parameters and initial state</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="stiff-ode.html"><a href="stiff-ode.html"><i class="fa fa-check"></i><b>13.5</b> Stiff ODEs</a></li>
<li class="chapter" data-level="13.6" data-path="control-ode.html"><a href="control-ode.html"><i class="fa fa-check"></i><b>13.6</b> Control parameters for ODE solving</a>
<ul>
<li class="chapter" data-level="" data-path="control-ode.html"><a href="control-ode.html#discontinuous-ode-system-function"><i class="fa fa-check"></i>Discontinuous ODE system function</a></li>
<li class="chapter" data-level="" data-path="control-ode.html"><a href="control-ode.html#tolerance-1"><i class="fa fa-check"></i>Tolerance</a></li>
<li class="chapter" data-level="" data-path="control-ode.html"><a href="control-ode.html#maximum-number-of-steps-1"><i class="fa fa-check"></i>Maximum number of steps</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="adjoint-ode.html"><a href="adjoint-ode.html"><i class="fa fa-check"></i><b>13.7</b> Adjoint ODE solver</a></li>
<li class="chapter" data-level="13.8" data-path="solving-a-system-of-linear-odes-using-a-matrix-exponential.html"><a href="solving-a-system-of-linear-odes-using-a-matrix-exponential.html"><i class="fa fa-check"></i><b>13.8</b> Solving a system of linear ODEs using a matrix exponential</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="integrate-1d.html"><a href="integrate-1d.html"><i class="fa fa-check"></i><b>14</b> Computing One Dimensional Integrals</a>
<ul>
<li class="chapter" data-level="14.1" data-path="calling-the-integrator.html"><a href="calling-the-integrator.html"><i class="fa fa-check"></i><b>14.1</b> Calling the integrator</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="calling-the-integrator.html"><a href="calling-the-integrator.html#limits-of-integration"><i class="fa fa-check"></i><b>14.1.1</b> Limits of integration</a></li>
<li class="chapter" data-level="14.1.2" data-path="calling-the-integrator.html"><a href="calling-the-integrator.html#data-vs.-parameters"><i class="fa fa-check"></i><b>14.1.2</b> Data vs. parameters</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="integrator-convergence.html"><a href="integrator-convergence.html"><i class="fa fa-check"></i><b>14.2</b> Integrator convergence</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="integrator-convergence.html"><a href="integrator-convergence.html#zero-crossing"><i class="fa fa-check"></i><b>14.2.1</b> Zero-crossing integrals</a></li>
<li class="chapter" data-level="14.2.2" data-path="integrator-convergence.html"><a href="integrator-convergence.html#integral-precision"><i class="fa fa-check"></i><b>14.2.2</b> Avoiding precision loss near limits of integration in definite integrals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="complex-numbers.html"><a href="complex-numbers.html"><i class="fa fa-check"></i><b>15</b> Complex Numbers</a>
<ul>
<li class="chapter" data-level="15.1" data-path="working-with-complex-numbers.html"><a href="working-with-complex-numbers.html"><i class="fa fa-check"></i><b>15.1</b> Working with complex numbers</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="working-with-complex-numbers.html"><a href="working-with-complex-numbers.html#constructing-and-accessing-complex-numbers"><i class="fa fa-check"></i><b>15.1.1</b> Constructing and accessing complex numbers</a></li>
<li class="chapter" data-level="15.1.2" data-path="working-with-complex-numbers.html"><a href="working-with-complex-numbers.html#complex-assignment-and-promotion"><i class="fa fa-check"></i><b>15.1.2</b> Complex assignment and promotion</a></li>
<li class="chapter" data-level="15.1.3" data-path="working-with-complex-numbers.html"><a href="working-with-complex-numbers.html#complex-arrays"><i class="fa fa-check"></i><b>15.1.3</b> Complex arrays</a></li>
<li class="chapter" data-level="15.1.4" data-path="working-with-complex-numbers.html"><a href="working-with-complex-numbers.html#complex-functions"><i class="fa fa-check"></i><b>15.1.4</b> Complex functions</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="complex-random-variables.html"><a href="complex-random-variables.html"><i class="fa fa-check"></i><b>15.2</b> Complex random variables</a></li>
<li class="chapter" data-level="15.3" data-path="complex-matrices-and-vectors.html"><a href="complex-matrices-and-vectors.html"><i class="fa fa-check"></i><b>15.3</b> Complex matrices and vectors</a></li>
<li class="chapter" data-level="15.4" data-path="complex-linear-regression.html"><a href="complex-linear-regression.html"><i class="fa fa-check"></i><b>15.4</b> Complex linear regression</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="complex-linear-regression.html"><a href="complex-linear-regression.html#independent-real-and-imaginary-error"><i class="fa fa-check"></i><b>15.4.1</b> Independent real and imaginary error</a></li>
<li class="chapter" data-level="15.4.2" data-path="complex-linear-regression.html"><a href="complex-linear-regression.html#dependent-complex-error"><i class="fa fa-check"></i><b>15.4.2</b> Dependent complex error</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="dae-solver.html"><a href="dae-solver.html"><i class="fa fa-check"></i><b>16</b> Differential-Algebraic Equations</a>
<ul>
<li class="chapter" data-level="16.1" data-path="notation-1.html"><a href="notation-1.html"><i class="fa fa-check"></i><b>16.1</b> Notation</a></li>
<li class="chapter" data-level="16.2" data-path="example-chemical-kinetics.html"><a href="example-chemical-kinetics.html"><i class="fa fa-check"></i><b>16.2</b> Example: chemical kinetics</a></li>
<li class="chapter" data-level="16.3" data-path="index-of-daes.html"><a href="index-of-daes.html"><i class="fa fa-check"></i><b>16.3</b> Index of DAEs</a></li>
<li class="chapter" data-level="16.4" data-path="coding-the-dae-system-function.html"><a href="coding-the-dae-system-function.html"><i class="fa fa-check"></i><b>16.4</b> Coding the DAE system function</a>
<ul>
<li class="chapter" data-level="" data-path="coding-the-dae-system-function.html"><a href="coding-the-dae-system-function.html#strict-signature-2"><i class="fa fa-check"></i>Strict signature</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="solving-daes.html"><a href="solving-daes.html"><i class="fa fa-check"></i><b>16.5</b> Solving DAEs</a></li>
<li class="chapter" data-level="16.6" data-path="control-dae.html"><a href="control-dae.html"><i class="fa fa-check"></i><b>16.6</b> Control parameters for DAE solving</a>
<ul>
<li class="chapter" data-level="" data-path="control-dae.html"><a href="control-dae.html#maximum-number-of-steps-2"><i class="fa fa-check"></i>Maximum number of steps</a></li>
</ul></li>
</ul></li>
<li><a href="part-2.-programming-techniques.html#part-2.-programming-techniques"><i style="font-size: 110%; color:#990017;">Part 2. Programming Techniques</i></a></li>
<li class="chapter" data-level="17" data-path="floating-point-arithmetic.html"><a href="floating-point-arithmetic.html"><i class="fa fa-check"></i><b>17</b> Floating Point Arithmetic</a>
<ul>
<li class="chapter" data-level="17.1" data-path="floating-point-representations.html"><a href="floating-point-representations.html"><i class="fa fa-check"></i><b>17.1</b> Floating-point representations</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="floating-point-representations.html"><a href="floating-point-representations.html#finite-values"><i class="fa fa-check"></i><b>17.1.1</b> Finite values</a></li>
<li class="chapter" data-level="17.1.2" data-path="floating-point-representations.html"><a href="floating-point-representations.html#normality"><i class="fa fa-check"></i><b>17.1.2</b> Normality</a></li>
<li class="chapter" data-level="17.1.3" data-path="floating-point-representations.html"><a href="floating-point-representations.html#ranges-and-extreme-values"><i class="fa fa-check"></i><b>17.1.3</b> Ranges and extreme values</a></li>
<li class="chapter" data-level="17.1.4" data-path="floating-point-representations.html"><a href="floating-point-representations.html#signed-zero"><i class="fa fa-check"></i><b>17.1.4</b> Signed zero</a></li>
<li class="chapter" data-level="17.1.5" data-path="floating-point-representations.html"><a href="floating-point-representations.html#not-a-number-values"><i class="fa fa-check"></i><b>17.1.5</b> Not-a-number values</a></li>
<li class="chapter" data-level="17.1.6" data-path="floating-point-representations.html"><a href="floating-point-representations.html#positive-and-negative-infinity"><i class="fa fa-check"></i><b>17.1.6</b> Positive and negative infinity</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="literals-decimal-and-scientific-notation.html"><a href="literals-decimal-and-scientific-notation.html"><i class="fa fa-check"></i><b>17.2</b> Literals: decimal and scientific notation</a></li>
<li class="chapter" data-level="17.3" data-path="arithmetic-precision.html"><a href="arithmetic-precision.html"><i class="fa fa-check"></i><b>17.3</b> Arithmetic precision</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="arithmetic-precision.html"><a href="arithmetic-precision.html#rounding-and-probabilities"><i class="fa fa-check"></i><b>17.3.1</b> Rounding and probabilities</a></li>
<li class="chapter" data-level="17.3.2" data-path="arithmetic-precision.html"><a href="arithmetic-precision.html#machine-precision-and-the-asymmetry-of-0-and-1"><i class="fa fa-check"></i><b>17.3.2</b> Machine precision and the asymmetry of 0 and 1</a></li>
<li class="chapter" data-level="17.3.3" data-path="arithmetic-precision.html"><a href="arithmetic-precision.html#complementary-and-epsilon-functions"><i class="fa fa-check"></i><b>17.3.3</b> Complementary and epsilon functions</a></li>
<li class="chapter" data-level="17.3.4" data-path="arithmetic-precision.html"><a href="arithmetic-precision.html#catastrophic-cancellation"><i class="fa fa-check"></i><b>17.3.4</b> Catastrophic cancellation</a></li>
<li class="chapter" data-level="17.3.5" data-path="arithmetic-precision.html"><a href="arithmetic-precision.html#overflow"><i class="fa fa-check"></i><b>17.3.5</b> Overflow</a></li>
<li class="chapter" data-level="17.3.6" data-path="arithmetic-precision.html"><a href="arithmetic-precision.html#underflow-and-the-log-scale"><i class="fa fa-check"></i><b>17.3.6</b> Underflow and the log scale</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="log-sum-of-exponentials.html"><a href="log-sum-of-exponentials.html"><i class="fa fa-check"></i><b>17.4</b> Log sum of exponentials</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="log-sum-of-exponentials.html"><a href="log-sum-of-exponentials.html#log-sum-exp-function"><i class="fa fa-check"></i><b>17.4.1</b> Log-sum-exp function</a></li>
<li class="chapter" data-level="17.4.2" data-path="log-sum-of-exponentials.html"><a href="log-sum-of-exponentials.html#applying-log-sum-exp-to-a-sequence"><i class="fa fa-check"></i><b>17.4.2</b> Applying log-sum-exp to a sequence</a></li>
<li class="chapter" data-level="17.4.3" data-path="log-sum-of-exponentials.html"><a href="log-sum-of-exponentials.html#calculating-means-with-log-sum-exp"><i class="fa fa-check"></i><b>17.4.3</b> Calculating means with log-sum-exp</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="comparing-floating-point-numbers.html"><a href="comparing-floating-point-numbers.html"><i class="fa fa-check"></i><b>17.5</b> Comparing floating-point numbers</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="matrices-vectors-and-arrays.html"><a href="matrices-vectors-and-arrays.html"><i class="fa fa-check"></i><b>18</b> Matrices, Vectors, and Arrays</a>
<ul>
<li class="chapter" data-level="18.1" data-path="basic-motivation.html"><a href="basic-motivation.html"><i class="fa fa-check"></i><b>18.1</b> Basic motivation</a></li>
<li class="chapter" data-level="18.2" data-path="fixed-sizes-and-indexing-out-of-bounds.html"><a href="fixed-sizes-and-indexing-out-of-bounds.html"><i class="fa fa-check"></i><b>18.2</b> Fixed sizes and indexing out of bounds</a></li>
<li class="chapter" data-level="18.3" data-path="indexing-efficiency.html"><a href="indexing-efficiency.html"><i class="fa fa-check"></i><b>18.3</b> Data type and indexing efficiency</a>
<ul>
<li class="chapter" data-level="" data-path="indexing-efficiency.html"><a href="indexing-efficiency.html#matrices-vs.-two-dimensional-arrays"><i class="fa fa-check"></i>Matrices vs. two-dimensional arrays</a></li>
<li class="chapter" data-level="" data-path="indexing-efficiency.html"><a href="indexing-efficiency.html#row-vectors-vs.-one-dimensional-arrays"><i class="fa fa-check"></i>(Row) vectors vs. one-dimensional arrays</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="memory-locality.html"><a href="memory-locality.html"><i class="fa fa-check"></i><b>18.4</b> Memory locality</a>
<ul>
<li class="chapter" data-level="" data-path="memory-locality.html"><a href="memory-locality.html#memory-locality-1"><i class="fa fa-check"></i>Memory locality</a></li>
<li class="chapter" data-level="" data-path="memory-locality.html"><a href="memory-locality.html#matrices"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="memory-locality.html"><a href="memory-locality.html#arrays"><i class="fa fa-check"></i>Arrays</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="converting-among-matrix-vector-and-array-types.html"><a href="converting-among-matrix-vector-and-array-types.html"><i class="fa fa-check"></i><b>18.5</b> Converting among matrix, vector, and array types</a></li>
<li class="chapter" data-level="18.6" data-path="aliasing-in-stan-containers.html"><a href="aliasing-in-stan-containers.html"><i class="fa fa-check"></i><b>18.6</b> Aliasing in Stan containers</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="multi-indexing.html"><a href="multi-indexing.html"><i class="fa fa-check"></i><b>19</b> Multiple Indexing and Range Indexing</a>
<ul>
<li class="chapter" data-level="19.1" data-path="multiple-indexing.html"><a href="multiple-indexing.html"><i class="fa fa-check"></i><b>19.1</b> Multiple indexing</a></li>
<li class="chapter" data-level="19.2" data-path="slicing-with-range-indexes.html"><a href="slicing-with-range-indexes.html"><i class="fa fa-check"></i><b>19.2</b> Slicing with range indexes</a>
<ul>
<li class="chapter" data-level="" data-path="slicing-with-range-indexes.html"><a href="slicing-with-range-indexes.html#lower-and-upper-bound-indexes"><i class="fa fa-check"></i>Lower and upper bound indexes</a></li>
<li class="chapter" data-level="" data-path="slicing-with-range-indexes.html"><a href="slicing-with-range-indexes.html#lower-or-upper-bound-indexes"><i class="fa fa-check"></i>Lower or upper bound indexes</a></li>
<li class="chapter" data-level="" data-path="slicing-with-range-indexes.html"><a href="slicing-with-range-indexes.html#full-range-indexes"><i class="fa fa-check"></i>Full range indexes</a></li>
<li class="chapter" data-level="" data-path="slicing-with-range-indexes.html"><a href="slicing-with-range-indexes.html#slicing-functions"><i class="fa fa-check"></i>Slicing functions</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="multiple-indexing-on-the-left-of-assignments.html"><a href="multiple-indexing-on-the-left-of-assignments.html"><i class="fa fa-check"></i><b>19.3</b> Multiple indexing on the left of assignments</a>
<ul>
<li class="chapter" data-level="" data-path="multiple-indexing-on-the-left-of-assignments.html"><a href="multiple-indexing-on-the-left-of-assignments.html#assign-by-value-and-aliasing"><i class="fa fa-check"></i>Assign-by-value and aliasing</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="multiple-indexes-with-vectors-and-matrices.html"><a href="multiple-indexes-with-vectors-and-matrices.html"><i class="fa fa-check"></i><b>19.4</b> Multiple indexes with vectors and matrices</a>
<ul>
<li class="chapter" data-level="" data-path="multiple-indexes-with-vectors-and-matrices.html"><a href="multiple-indexes-with-vectors-and-matrices.html#vectors"><i class="fa fa-check"></i>Vectors</a></li>
<li class="chapter" data-level="" data-path="multiple-indexes-with-vectors-and-matrices.html"><a href="multiple-indexes-with-vectors-and-matrices.html#matrices-1"><i class="fa fa-check"></i>Matrices</a></li>
<li class="chapter" data-level="" data-path="multiple-indexes-with-vectors-and-matrices.html"><a href="multiple-indexes-with-vectors-and-matrices.html#matrices-with-one-multiple-index"><i class="fa fa-check"></i>Matrices with one multiple index</a></li>
<li class="chapter" data-level="" data-path="multiple-indexes-with-vectors-and-matrices.html"><a href="multiple-indexes-with-vectors-and-matrices.html#arrays-of-vectors-or-matrices"><i class="fa fa-check"></i>Arrays of vectors or matrices</a></li>
<li class="chapter" data-level="" data-path="multiple-indexes-with-vectors-and-matrices.html"><a href="multiple-indexes-with-vectors-and-matrices.html#block-row-and-column-extraction-for-matrices"><i class="fa fa-check"></i>Block, row, and column extraction for matrices</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="matrices-with-parameters-and-constants.html"><a href="matrices-with-parameters-and-constants.html"><i class="fa fa-check"></i><b>19.5</b> Matrices with parameters and constants</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="functions-programming.html"><a href="functions-programming.html"><i class="fa fa-check"></i><b>20</b> User-Defined Functions</a>
<ul>
<li class="chapter" data-level="20.1" data-path="basic-functions.html"><a href="basic-functions.html"><i class="fa fa-check"></i><b>20.1</b> Basic functions</a>
<ul>
<li class="chapter" data-level="" data-path="basic-functions.html"><a href="basic-functions.html#user-defined-functions-block"><i class="fa fa-check"></i>User-defined functions block</a></li>
<li class="chapter" data-level="" data-path="basic-functions.html"><a href="basic-functions.html#function-bodies"><i class="fa fa-check"></i>Function bodies</a></li>
<li class="chapter" data-level="" data-path="basic-functions.html"><a href="basic-functions.html#return-statements"><i class="fa fa-check"></i>Return statements</a></li>
<li class="chapter" data-level="" data-path="basic-functions.html"><a href="basic-functions.html#reject-statements"><i class="fa fa-check"></i>Reject statements</a></li>
<li class="chapter" data-level="" data-path="basic-functions.html"><a href="basic-functions.html#type-declarations-for-functions"><i class="fa fa-check"></i>Type declarations for functions</a></li>
<li class="chapter" data-level="" data-path="basic-functions.html"><a href="basic-functions.html#array-types-for-function-declarations"><i class="fa fa-check"></i>Array types for function declarations</a></li>
<li class="chapter" data-level="" data-path="basic-functions.html"><a href="basic-functions.html#data-only-function-arguments"><i class="fa fa-check"></i>Data-only function arguments</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="functions-as-statements.html"><a href="functions-as-statements.html"><i class="fa fa-check"></i><b>20.2</b> Functions as statements</a></li>
<li class="chapter" data-level="20.3" data-path="functions-accessing-the-log-probability-accumulator.html"><a href="functions-accessing-the-log-probability-accumulator.html"><i class="fa fa-check"></i><b>20.3</b> Functions accessing the log probability accumulator</a></li>
<li class="chapter" data-level="20.4" data-path="functions-acting-as-random-number-generators.html"><a href="functions-acting-as-random-number-generators.html"><i class="fa fa-check"></i><b>20.4</b> Functions acting as random number generators</a></li>
<li class="chapter" data-level="20.5" data-path="user-defined-probability-functions.html"><a href="user-defined-probability-functions.html"><i class="fa fa-check"></i><b>20.5</b> User-defined probability functions</a></li>
<li class="chapter" data-level="20.6" data-path="overloading-functions.html"><a href="overloading-functions.html"><i class="fa fa-check"></i><b>20.6</b> Overloading functions</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="overloading-functions.html"><a href="overloading-functions.html#warning-on-usage"><i class="fa fa-check"></i><b>20.6.1</b> Warning on usage</a></li>
<li class="chapter" data-level="20.6.2" data-path="overloading-functions.html"><a href="overloading-functions.html#function-resolution"><i class="fa fa-check"></i><b>20.6.2</b> Function resolution</a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="documenting-functions.html"><a href="documenting-functions.html"><i class="fa fa-check"></i><b>20.7</b> Documenting functions</a></li>
<li class="chapter" data-level="20.8" data-path="summary-of-function-types.html"><a href="summary-of-function-types.html"><i class="fa fa-check"></i><b>20.8</b> Summary of function types</a>
<ul>
<li class="chapter" data-level="" data-path="summary-of-function-types.html"><a href="summary-of-function-types.html#void-vs.-non-void-return"><i class="fa fa-check"></i>Void vs. non-void return</a></li>
<li class="chapter" data-level="" data-path="summary-of-function-types.html"><a href="summary-of-function-types.html#suffixed-or-non-suffixed"><i class="fa fa-check"></i>Suffixed or non-suffixed</a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="recursive-functions.html"><a href="recursive-functions.html"><i class="fa fa-check"></i><b>20.9</b> Recursive functions</a></li>
<li class="chapter" data-level="20.10" data-path="truncated-random-number-generation.html"><a href="truncated-random-number-generation.html"><i class="fa fa-check"></i><b>20.10</b> Truncated random number generation</a>
<ul>
<li class="chapter" data-level="" data-path="truncated-random-number-generation.html"><a href="truncated-random-number-generation.html#generation-with-inverse-cdfs"><i class="fa fa-check"></i>Generation with inverse CDFs</a></li>
<li class="chapter" data-level="" data-path="truncated-random-number-generation.html"><a href="truncated-random-number-generation.html#truncated-variate-generation"><i class="fa fa-check"></i>Truncated variate generation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="custom-probability-functions.html"><a href="custom-probability-functions.html"><i class="fa fa-check"></i><b>21</b> Custom Probability Functions</a>
<ul>
<li class="chapter" data-level="21.1" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>21.1</b> Examples</a>
<ul>
<li class="chapter" data-level="" data-path="examples.html"><a href="examples.html#triangle-distribution"><i class="fa fa-check"></i>Triangle distribution</a></li>
<li class="chapter" data-level="" data-path="examples.html"><a href="examples.html#exponential-distribution"><i class="fa fa-check"></i>Exponential distribution</a></li>
<li class="chapter" data-level="" data-path="examples.html"><a href="examples.html#bivariate-normal-cumulative-distribution-function"><i class="fa fa-check"></i>Bivariate normal cumulative distribution function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="proportionality-constants.html"><a href="proportionality-constants.html"><i class="fa fa-check"></i><b>22</b> Proportionality Constants</a>
<ul>
<li class="chapter" data-level="22.1" data-path="dropping-proportionality-constants.html"><a href="dropping-proportionality-constants.html"><i class="fa fa-check"></i><b>22.1</b> Dropping Proportionality Constants</a></li>
<li class="chapter" data-level="22.2" data-path="keeping-proportionality-constants.html"><a href="keeping-proportionality-constants.html"><i class="fa fa-check"></i><b>22.2</b> Keeping Proportionality Constants</a></li>
<li class="chapter" data-level="22.3" data-path="user-defined-distributions.html"><a href="user-defined-distributions.html"><i class="fa fa-check"></i><b>22.3</b> User-defined Distributions</a></li>
<li class="chapter" data-level="22.4" data-path="limitations-on-using-_lupdf-and-_lupmf-functions.html"><a href="limitations-on-using-_lupdf-and-_lupmf-functions.html"><i class="fa fa-check"></i><b>22.4</b> Limitations on Using <code>_lupdf</code> and <code>_lupmf</code> Functions</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="problematic-posteriors.html"><a href="problematic-posteriors.html"><i class="fa fa-check"></i><b>23</b> Problematic Posteriors</a>
<ul>
<li class="chapter" data-level="23.1" data-path="collinearity.html"><a href="collinearity.html"><i class="fa fa-check"></i><b>23.1</b> Collinearity of predictors in regressions</a>
<ul>
<li class="chapter" data-level="" data-path="collinearity.html"><a href="collinearity.html#examples-of-collinearity"><i class="fa fa-check"></i>Examples of collinearity</a></li>
<li class="chapter" data-level="" data-path="collinearity.html"><a href="collinearity.html#mitigating-the-invariances"><i class="fa fa-check"></i>Mitigating the invariances</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="label-switching-problematic.html"><a href="label-switching-problematic.html"><i class="fa fa-check"></i><b>23.2</b> Label switching in mixture models</a>
<ul>
<li class="chapter" data-level="" data-path="label-switching-problematic.html"><a href="label-switching-problematic.html#mixture-models"><i class="fa fa-check"></i>Mixture models</a></li>
<li class="chapter" data-level="" data-path="label-switching-problematic.html"><a href="label-switching-problematic.html#convergence-monitoring-and-effective-sample-size"><i class="fa fa-check"></i>Convergence monitoring and effective sample size</a></li>
<li class="chapter" data-level="" data-path="label-switching-problematic.html"><a href="label-switching-problematic.html#some-inferences-are-invariant"><i class="fa fa-check"></i>Some inferences are invariant</a></li>
<li class="chapter" data-level="" data-path="label-switching-problematic.html"><a href="label-switching-problematic.html#highly-multimodal-posteriors"><i class="fa fa-check"></i>Highly multimodal posteriors</a></li>
<li class="chapter" data-level="" data-path="label-switching-problematic.html"><a href="label-switching-problematic.html#hacks-as-fixes"><i class="fa fa-check"></i>Hacks as fixes</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="component-collapsing-in-mixture-models.html"><a href="component-collapsing-in-mixture-models.html"><i class="fa fa-check"></i><b>23.3</b> Component collapsing in mixture models</a></li>
<li class="chapter" data-level="23.4" data-path="posteriors-with-unbounded-densities.html"><a href="posteriors-with-unbounded-densities.html"><i class="fa fa-check"></i><b>23.4</b> Posteriors with unbounded densities</a>
<ul>
<li class="chapter" data-level="" data-path="posteriors-with-unbounded-densities.html"><a href="posteriors-with-unbounded-densities.html#mixture-models-with-varying-scales"><i class="fa fa-check"></i>Mixture models with varying scales</a></li>
<li class="chapter" data-level="" data-path="posteriors-with-unbounded-densities.html"><a href="posteriors-with-unbounded-densities.html#beta-binomial-models-with-skewed-data-and-weak-priors"><i class="fa fa-check"></i>Beta-binomial models with skewed data and weak priors</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="posteriors-with-unbounded-parameters.html"><a href="posteriors-with-unbounded-parameters.html"><i class="fa fa-check"></i><b>23.5</b> Posteriors with unbounded parameters</a>
<ul>
<li class="chapter" data-level="" data-path="posteriors-with-unbounded-parameters.html"><a href="posteriors-with-unbounded-parameters.html#separability-in-logistic-regression"><i class="fa fa-check"></i>Separability in logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="23.6" data-path="uniform-posteriors.html"><a href="uniform-posteriors.html"><i class="fa fa-check"></i><b>23.6</b> Uniform posteriors</a></li>
<li class="chapter" data-level="23.7" data-path="sampling-difficulties-with-problematic-priors.html"><a href="sampling-difficulties-with-problematic-priors.html"><i class="fa fa-check"></i><b>23.7</b> Sampling difficulties with problematic priors</a>
<ul>
<li class="chapter" data-level="" data-path="sampling-difficulties-with-problematic-priors.html"><a href="sampling-difficulties-with-problematic-priors.html#gibbs-sampling"><i class="fa fa-check"></i>Gibbs sampling</a></li>
<li class="chapter" data-level="" data-path="sampling-difficulties-with-problematic-priors.html"><a href="sampling-difficulties-with-problematic-priors.html#hamiltonian-monte-carlo-sampling"><i class="fa fa-check"></i>Hamiltonian Monte Carlo sampling</a></li>
<li class="chapter" data-level="" data-path="sampling-difficulties-with-problematic-priors.html"><a href="sampling-difficulties-with-problematic-priors.html#no-u-turn-sampling"><i class="fa fa-check"></i>No-U-turn sampling</a></li>
<li class="chapter" data-level="" data-path="sampling-difficulties-with-problematic-priors.html"><a href="sampling-difficulties-with-problematic-priors.html#examples-fits-in-stan"><i class="fa fa-check"></i>Examples: fits in Stan</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="change-of-variables.html"><a href="change-of-variables.html"><i class="fa fa-check"></i><b>24</b> Reparameterization and Change of Variables</a>
<ul>
<li class="chapter" data-level="24.1" data-path="theoretical-and-practical-background.html"><a href="theoretical-and-practical-background.html"><i class="fa fa-check"></i><b>24.1</b> Theoretical and practical background</a></li>
<li class="chapter" data-level="24.2" data-path="reparameterizations.html"><a href="reparameterizations.html"><i class="fa fa-check"></i><b>24.2</b> Reparameterizations</a>
<ul>
<li class="chapter" data-level="" data-path="reparameterizations.html"><a href="reparameterizations.html#beta-and-dirichlet-priors"><i class="fa fa-check"></i>Beta and Dirichlet priors</a></li>
<li class="chapter" data-level="" data-path="reparameterizations.html"><a href="reparameterizations.html#transforming-unconstrained-priors-probit-and-logit"><i class="fa fa-check"></i>Transforming unconstrained priors: probit and logit</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="changes-of-variables.html"><a href="changes-of-variables.html"><i class="fa fa-check"></i><b>24.3</b> Changes of variables</a>
<ul>
<li class="chapter" data-level="" data-path="changes-of-variables.html"><a href="changes-of-variables.html#change-of-variables-vs.-transformations"><i class="fa fa-check"></i>Change of variables vs. transformations</a></li>
<li class="chapter" data-level="" data-path="changes-of-variables.html"><a href="changes-of-variables.html#multivariate-changes-of-variables"><i class="fa fa-check"></i>Multivariate changes of variables</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="vectors-with-varying-bounds.html"><a href="vectors-with-varying-bounds.html"><i class="fa fa-check"></i><b>24.4</b> Vectors with varying bounds</a>
<ul>
<li class="chapter" data-level="" data-path="vectors-with-varying-bounds.html"><a href="vectors-with-varying-bounds.html#varying-lower-bounds"><i class="fa fa-check"></i>Varying lower bounds</a></li>
<li class="chapter" data-level="" data-path="vectors-with-varying-bounds.html"><a href="vectors-with-varying-bounds.html#varying-upper-and-lower-bounds"><i class="fa fa-check"></i>Varying upper and lower bounds</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>25</b> Efficiency Tuning</a>
<ul>
<li class="chapter" data-level="25.1" data-path="what-is-efficiency.html"><a href="what-is-efficiency.html"><i class="fa fa-check"></i><b>25.1</b> What is efficiency?</a></li>
<li class="chapter" data-level="25.2" data-path="efficiency-for-probabilistic-models-and-algorithms.html"><a href="efficiency-for-probabilistic-models-and-algorithms.html"><i class="fa fa-check"></i><b>25.2</b> Efficiency for probabilistic models and algorithms</a></li>
<li class="chapter" data-level="25.3" data-path="statistical-vs.-computational-efficiency.html"><a href="statistical-vs.-computational-efficiency.html"><i class="fa fa-check"></i><b>25.3</b> Statistical vs.  computational efficiency</a></li>
<li class="chapter" data-level="25.4" data-path="model-conditioning-and-curvature.html"><a href="model-conditioning-and-curvature.html"><i class="fa fa-check"></i><b>25.4</b> Model conditioning and curvature</a>
<ul>
<li class="chapter" data-level="" data-path="model-conditioning-and-curvature.html"><a href="model-conditioning-and-curvature.html#condition-number-and-adaptation"><i class="fa fa-check"></i>Condition number and adaptation</a></li>
<li class="chapter" data-level="" data-path="model-conditioning-and-curvature.html"><a href="model-conditioning-and-curvature.html#unit-scales-without-correlation"><i class="fa fa-check"></i>Unit scales without correlation</a></li>
<li class="chapter" data-level="" data-path="model-conditioning-and-curvature.html"><a href="model-conditioning-and-curvature.html#varying-curvature"><i class="fa fa-check"></i>Varying curvature</a></li>
<li class="chapter" data-level="" data-path="model-conditioning-and-curvature.html"><a href="model-conditioning-and-curvature.html#reparameterizing-with-a-change-of-variables"><i class="fa fa-check"></i>Reparameterizing with a change of variables</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="well-specified-models.html"><a href="well-specified-models.html"><i class="fa fa-check"></i><b>25.5</b> Well-specified models</a></li>
<li class="chapter" data-level="25.6" data-path="avoiding-validation.html"><a href="avoiding-validation.html"><i class="fa fa-check"></i><b>25.6</b> Avoiding validation</a></li>
<li class="chapter" data-level="25.7" data-path="reparameterization.html"><a href="reparameterization.html"><i class="fa fa-check"></i><b>25.7</b> Reparameterization</a>
<ul>
<li class="chapter" data-level="" data-path="reparameterization.html"><a href="reparameterization.html#funnel.figure"><i class="fa fa-check"></i>Example: Neal’s funnel</a></li>
<li class="chapter" data-level="" data-path="reparameterization.html"><a href="reparameterization.html#reparameterizing-the-cauchy"><i class="fa fa-check"></i>Reparameterizing the Cauchy</a></li>
<li class="chapter" data-level="" data-path="reparameterization.html"><a href="reparameterization.html#reparameterizing-a-student-t-distribution"><i class="fa fa-check"></i>Reparameterizing a Student-t distribution</a></li>
<li class="chapter" data-level="" data-path="reparameterization.html"><a href="reparameterization.html#hierarchical-models-and-the-non-centered-parameterization"><i class="fa fa-check"></i>Hierarchical models and the non-centered parameterization</a></li>
<li class="chapter" data-level="" data-path="reparameterization.html"><a href="reparameterization.html#non-centered-parameterization"><i class="fa fa-check"></i>Non-centered parameterization</a></li>
<li class="chapter" data-level="" data-path="reparameterization.html"><a href="reparameterization.html#multivariate-reparameterizations"><i class="fa fa-check"></i>Multivariate reparameterizations</a></li>
</ul></li>
<li class="chapter" data-level="25.8" data-path="vectorization.html"><a href="vectorization.html"><i class="fa fa-check"></i><b>25.8</b> Vectorization</a>
<ul>
<li class="chapter" data-level="" data-path="vectorization.html"><a href="vectorization.html#gradient-bottleneck"><i class="fa fa-check"></i>Gradient bottleneck</a></li>
<li class="chapter" data-level="" data-path="vectorization.html"><a href="vectorization.html#vectorizing-summations"><i class="fa fa-check"></i>Vectorizing summations</a></li>
<li class="chapter" data-level="" data-path="vectorization.html"><a href="vectorization.html#vectorization-through-matrix-operations"><i class="fa fa-check"></i>Vectorization through matrix operations</a></li>
<li class="chapter" data-level="" data-path="vectorization.html"><a href="vectorization.html#vectorized-probability-functions"><i class="fa fa-check"></i>Vectorized probability functions</a></li>
<li class="chapter" data-level="" data-path="vectorization.html"><a href="vectorization.html#reshaping-data-for-vectorization"><i class="fa fa-check"></i>Reshaping data for vectorization</a></li>
</ul></li>
<li class="chapter" data-level="25.9" data-path="exploiting-sufficient-statistics.html"><a href="exploiting-sufficient-statistics.html"><i class="fa fa-check"></i><b>25.9</b> Exploiting sufficient statistics</a></li>
<li class="chapter" data-level="25.10" data-path="aggregating-common-subexpressions.html"><a href="aggregating-common-subexpressions.html"><i class="fa fa-check"></i><b>25.10</b> Aggregating common subexpressions</a></li>
<li class="chapter" data-level="25.11" data-path="exploiting-conjugacy.html"><a href="exploiting-conjugacy.html"><i class="fa fa-check"></i><b>25.11</b> Exploiting conjugacy</a></li>
<li class="chapter" data-level="25.12" data-path="standardizing-predictors-and-outputs.html"><a href="standardizing-predictors-and-outputs.html"><i class="fa fa-check"></i><b>25.12</b> Standardizing predictors and outputs</a>
<ul>
<li class="chapter" data-level="" data-path="standardizing-predictors-and-outputs.html"><a href="standardizing-predictors-and-outputs.html#standard-normal-distribution"><i class="fa fa-check"></i>Standard normal distribution</a></li>
</ul></li>
<li class="chapter" data-level="25.13" data-path="using-map-reduce.html"><a href="using-map-reduce.html"><i class="fa fa-check"></i><b>25.13</b> Using map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>26</b> Parallelization</a>
<ul>
<li class="chapter" data-level="26.1" data-path="reduce-sum.html"><a href="reduce-sum.html"><i class="fa fa-check"></i><b>26.1</b> Reduce-sum</a>
<ul>
<li class="chapter" data-level="26.1.1" data-path="reduce-sum.html"><a href="reduce-sum.html#example-logistic-regression"><i class="fa fa-check"></i><b>26.1.1</b> Example: logistic regression</a></li>
<li class="chapter" data-level="26.1.2" data-path="reduce-sum.html"><a href="reduce-sum.html#reduce-sum-grainsize"><i class="fa fa-check"></i><b>26.1.2</b> Picking the grainsize</a></li>
</ul></li>
<li class="chapter" data-level="26.2" data-path="map-rect.html"><a href="map-rect.html"><i class="fa fa-check"></i><b>26.2</b> Map-rect</a>
<ul>
<li class="chapter" data-level="26.2.1" data-path="map-rect.html"><a href="map-rect.html#map-function"><i class="fa fa-check"></i><b>26.2.1</b> Map function</a></li>
<li class="chapter" data-level="" data-path="map-rect.html"><a href="map-rect.html#map-function-signature"><i class="fa fa-check"></i>Map function signature</a></li>
<li class="chapter" data-level="26.2.2" data-path="map-rect.html"><a href="map-rect.html#example-logistic-regression-1"><i class="fa fa-check"></i><b>26.2.2</b> Example: logistic regression</a></li>
<li class="chapter" data-level="26.2.3" data-path="map-rect.html"><a href="map-rect.html#example-hierarchical-logistic-regression"><i class="fa fa-check"></i><b>26.2.3</b> Example: hierarchical logistic regression</a></li>
<li class="chapter" data-level="26.2.4" data-path="map-rect.html"><a href="map-rect.html#ragged-inputs-and-outputs"><i class="fa fa-check"></i><b>26.2.4</b> Ragged inputs and outputs</a></li>
</ul></li>
<li class="chapter" data-level="26.3" data-path="opencl.html"><a href="opencl.html"><i class="fa fa-check"></i><b>26.3</b> OpenCL</a></li>
</ul></li>
<li><a href="meta-models.html#meta-models.part"><i style="font-size: 110%; color:#990017;">Part 3. Posterior Inference &amp; Model Checking</i></a></li>
<li class="chapter" data-level="27" data-path="posterior-prediction.html"><a href="posterior-prediction.html"><i class="fa fa-check"></i><b>27</b> Posterior Predictive Sampling</a>
<ul>
<li class="chapter" data-level="27.1" data-path="posterior-predictive-distribution.html"><a href="posterior-predictive-distribution.html"><i class="fa fa-check"></i><b>27.1</b> Posterior predictive distribution</a></li>
<li class="chapter" data-level="27.2" data-path="computing-the-posterior-predictive-distribution.html"><a href="computing-the-posterior-predictive-distribution.html"><i class="fa fa-check"></i><b>27.2</b> Computing the posterior predictive distribution</a></li>
<li class="chapter" data-level="27.3" data-path="sampling-from-the-posterior-predictive-distribution.html"><a href="sampling-from-the-posterior-predictive-distribution.html"><i class="fa fa-check"></i><b>27.3</b> Sampling from the posterior predictive distribution</a></li>
<li class="chapter" data-level="27.4" data-path="posterior-predictive-simulation-in-stan.html"><a href="posterior-predictive-simulation-in-stan.html"><i class="fa fa-check"></i><b>27.4</b> Posterior predictive simulation in Stan</a>
<ul>
<li class="chapter" data-level="27.4.1" data-path="posterior-predictive-simulation-in-stan.html"><a href="posterior-predictive-simulation-in-stan.html#simple-poisson-model"><i class="fa fa-check"></i><b>27.4.1</b> Simple Poisson model</a></li>
<li class="chapter" data-level="27.4.2" data-path="posterior-predictive-simulation-in-stan.html"><a href="posterior-predictive-simulation-in-stan.html#stan-code"><i class="fa fa-check"></i><b>27.4.2</b> Stan code</a></li>
<li class="chapter" data-level="27.4.3" data-path="posterior-predictive-simulation-in-stan.html"><a href="posterior-predictive-simulation-in-stan.html#analytic-posterior-and-posterior-predictive"><i class="fa fa-check"></i><b>27.4.3</b> Analytic posterior and posterior predictive</a></li>
</ul></li>
<li class="chapter" data-level="27.5" data-path="posterior-prediction-for-regressions.html"><a href="posterior-prediction-for-regressions.html"><i class="fa fa-check"></i><b>27.5</b> Posterior prediction for regressions</a>
<ul>
<li class="chapter" data-level="27.5.1" data-path="posterior-prediction-for-regressions.html"><a href="posterior-prediction-for-regressions.html#posterior-predictive-distributions-for-regressions"><i class="fa fa-check"></i><b>27.5.1</b> Posterior predictive distributions for regressions</a></li>
<li class="chapter" data-level="27.5.2" data-path="posterior-prediction-for-regressions.html"><a href="posterior-prediction-for-regressions.html#stan-program"><i class="fa fa-check"></i><b>27.5.2</b> Stan program</a></li>
</ul></li>
<li class="chapter" data-level="27.6" data-path="estimating-event-probabilities.html"><a href="estimating-event-probabilities.html"><i class="fa fa-check"></i><b>27.6</b> Estimating event probabilities</a></li>
<li class="chapter" data-level="27.7" data-path="stand-alone-generated-quantities-and-ongoing-prediction.html"><a href="stand-alone-generated-quantities-and-ongoing-prediction.html"><i class="fa fa-check"></i><b>27.7</b> Stand-alone generated quantities and ongoing prediction</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="simulation-based-calibration.html"><a href="simulation-based-calibration.html"><i class="fa fa-check"></i><b>28</b> Simulation-Based Calibration</a>
<ul>
<li class="chapter" data-level="28.1" data-path="bayes-is-calibrated-by-construction.html"><a href="bayes-is-calibrated-by-construction.html"><i class="fa fa-check"></i><b>28.1</b> Bayes is calibrated by construction</a></li>
<li class="chapter" data-level="28.2" data-path="simulation-based-calibration-1.html"><a href="simulation-based-calibration-1.html"><i class="fa fa-check"></i><b>28.2</b> Simulation-based calibration</a></li>
<li class="chapter" data-level="28.3" data-path="sbc-in-stan.html"><a href="sbc-in-stan.html"><i class="fa fa-check"></i><b>28.3</b> SBC in Stan</a>
<ul>
<li class="chapter" data-level="28.3.1" data-path="sbc-in-stan.html"><a href="sbc-in-stan.html#example-model"><i class="fa fa-check"></i><b>28.3.1</b> Example model</a></li>
<li class="chapter" data-level="28.3.2" data-path="sbc-in-stan.html"><a href="sbc-in-stan.html#testing-a-stan-program-with-simulation-based-calibration"><i class="fa fa-check"></i><b>28.3.2</b> Testing a Stan program with simulation-based calibration</a></li>
<li class="chapter" data-level="28.3.3" data-path="sbc-in-stan.html"><a href="sbc-in-stan.html#pseudocode-for-simulation-based-calibration"><i class="fa fa-check"></i><b>28.3.3</b> Pseudocode for simulation-based calibration</a></li>
<li class="chapter" data-level="28.3.4" data-path="sbc-in-stan.html"><a href="sbc-in-stan.html#the-importance-of-thinning"><i class="fa fa-check"></i><b>28.3.4</b> The importance of thinning</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="testing-uniformity.html"><a href="testing-uniformity.html"><i class="fa fa-check"></i><b>28.4</b> Testing uniformity</a>
<ul>
<li class="chapter" data-level="28.4.1" data-path="testing-uniformity.html"><a href="testing-uniformity.html#indexing-to-simplify-arithmetic"><i class="fa fa-check"></i><b>28.4.1</b> Indexing to simplify arithmetic</a></li>
</ul></li>
<li class="chapter" data-level="28.5" data-path="examples-of-simulation-based-calibration.html"><a href="examples-of-simulation-based-calibration.html"><i class="fa fa-check"></i><b>28.5</b> Examples of simulation-based calibration</a>
<ul>
<li class="chapter" data-level="28.5.1" data-path="examples-of-simulation-based-calibration.html"><a href="examples-of-simulation-based-calibration.html#when-things-go-right"><i class="fa fa-check"></i><b>28.5.1</b> When things go right</a></li>
<li class="chapter" data-level="28.5.2" data-path="examples-of-simulation-based-calibration.html"><a href="examples-of-simulation-based-calibration.html#when-things-go-wrong"><i class="fa fa-check"></i><b>28.5.2</b> When things go wrong</a></li>
<li class="chapter" data-level="28.5.3" data-path="examples-of-simulation-based-calibration.html"><a href="examples-of-simulation-based-calibration.html#when-stans-sampler-goes-wrong"><i class="fa fa-check"></i><b>28.5.3</b> When Stan’s sampler goes wrong</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="29" data-path="ppcs.html"><a href="ppcs.html"><i class="fa fa-check"></i><b>29</b> Posterior and Prior Predictive Checks</a>
<ul>
<li class="chapter" data-level="29.1" data-path="simulating-from-the-posterior-predictive-distribution.html"><a href="simulating-from-the-posterior-predictive-distribution.html"><i class="fa fa-check"></i><b>29.1</b> Simulating from the posterior predictive distribution</a></li>
<li class="chapter" data-level="29.2" data-path="plotting-multiples.html"><a href="plotting-multiples.html"><i class="fa fa-check"></i><b>29.2</b> Plotting multiples</a></li>
<li class="chapter" data-level="29.3" data-path="posterior-p-values.html"><a href="posterior-p-values.html"><i class="fa fa-check"></i><b>29.3</b> Posterior ``p-values’’</a>
<ul>
<li class="chapter" data-level="29.3.1" data-path="posterior-p-values.html"><a href="posterior-p-values.html#which-statistics-to-test"><i class="fa fa-check"></i><b>29.3.1</b> Which statistics to test?</a></li>
</ul></li>
<li class="chapter" data-level="29.4" data-path="prior-predictive-checks.html"><a href="prior-predictive-checks.html"><i class="fa fa-check"></i><b>29.4</b> Prior predictive checks</a>
<ul>
<li class="chapter" data-level="29.4.1" data-path="prior-predictive-checks.html"><a href="prior-predictive-checks.html#coding-prior-predictive-checks-in-stan"><i class="fa fa-check"></i><b>29.4.1</b> Coding prior predictive checks in Stan</a></li>
</ul></li>
<li class="chapter" data-level="29.5" data-path="example-of-prior-predictive-checks.html"><a href="example-of-prior-predictive-checks.html"><i class="fa fa-check"></i><b>29.5</b> Example of prior predictive checks</a></li>
<li class="chapter" data-level="29.6" data-path="mixed-replication.html"><a href="mixed-replication.html"><i class="fa fa-check"></i><b>29.6</b> Mixed predictive replication for hierarchical models</a></li>
<li class="chapter" data-level="29.7" data-path="joint-model-representation.html"><a href="joint-model-representation.html"><i class="fa fa-check"></i><b>29.7</b> Joint model representation</a>
<ul>
<li class="chapter" data-level="29.7.1" data-path="joint-model-representation.html"><a href="joint-model-representation.html#posterior-predictive-model"><i class="fa fa-check"></i><b>29.7.1</b> Posterior predictive model</a></li>
<li class="chapter" data-level="29.7.2" data-path="joint-model-representation.html"><a href="joint-model-representation.html#prior-predictive-model"><i class="fa fa-check"></i><b>29.7.2</b> Prior predictive model</a></li>
<li class="chapter" data-level="29.7.3" data-path="joint-model-representation.html"><a href="joint-model-representation.html#mixed-replication-for-hierarchical-models"><i class="fa fa-check"></i><b>29.7.3</b> Mixed replication for hierarchical models</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="30" data-path="held-out-evaluation-and-cross-validation.html"><a href="held-out-evaluation-and-cross-validation.html"><i class="fa fa-check"></i><b>30</b> Held-Out Evaluation and Cross-Validation</a>
<ul>
<li class="chapter" data-level="30.1" data-path="evaluating-posterior-predictive.html"><a href="evaluating-posterior-predictive.html"><i class="fa fa-check"></i><b>30.1</b> Evaluating posterior predictive densities</a>
<ul>
<li class="chapter" data-level="30.1.1" data-path="evaluating-posterior-predictive.html"><a href="evaluating-posterior-predictive.html#stan-program-1"><i class="fa fa-check"></i><b>30.1.1</b> Stan program</a></li>
</ul></li>
<li class="chapter" data-level="30.2" data-path="estimation-error.html"><a href="estimation-error.html"><i class="fa fa-check"></i><b>30.2</b> Estimation error</a>
<ul>
<li class="chapter" data-level="30.2.1" data-path="estimation-error.html"><a href="estimation-error.html#parameter-estimates"><i class="fa fa-check"></i><b>30.2.1</b> Parameter estimates</a></li>
<li class="chapter" data-level="30.2.2" data-path="estimation-error.html"><a href="estimation-error.html#predictive-estimates"><i class="fa fa-check"></i><b>30.2.2</b> Predictive estimates</a></li>
<li class="chapter" data-level="30.2.3" data-path="estimation-error.html"><a href="estimation-error.html#predictive-estimates-in-stan"><i class="fa fa-check"></i><b>30.2.3</b> Predictive estimates in Stan</a></li>
</ul></li>
<li class="chapter" data-level="30.3" data-path="cross-validation.html"><a href="cross-validation.html"><i class="fa fa-check"></i><b>30.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="30.3.1" data-path="cross-validation.html"><a href="cross-validation.html#stan-implementation-with-random-folds"><i class="fa fa-check"></i><b>30.3.1</b> Stan implementation with random folds</a></li>
<li class="chapter" data-level="30.3.2" data-path="cross-validation.html"><a href="cross-validation.html#user-defined-permutations"><i class="fa fa-check"></i><b>30.3.2</b> User-defined permutations</a></li>
<li class="chapter" data-level="30.3.3" data-path="cross-validation.html"><a href="cross-validation.html#cross-validation-with-structured-data"><i class="fa fa-check"></i><b>30.3.3</b> Cross-validation with structured data</a></li>
<li class="chapter" data-level="30.3.4" data-path="cross-validation.html"><a href="cross-validation.html#cross-validation-with-spatio-temporal-data"><i class="fa fa-check"></i><b>30.3.4</b> Cross-validation with spatio-temporal data</a></li>
<li class="chapter" data-level="30.3.5" data-path="cross-validation.html"><a href="cross-validation.html#approximate-cross-validation"><i class="fa fa-check"></i><b>30.3.5</b> Approximate cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="31" data-path="poststratification.html"><a href="poststratification.html"><i class="fa fa-check"></i><b>31</b> Poststratification</a>
<ul>
<li class="chapter" data-level="31.1" data-path="some-examples.html"><a href="some-examples.html"><i class="fa fa-check"></i><b>31.1</b> Some examples</a>
<ul>
<li class="chapter" data-level="31.1.1" data-path="some-examples.html"><a href="some-examples.html#earth-science"><i class="fa fa-check"></i><b>31.1.1</b> Earth science</a></li>
<li class="chapter" data-level="31.1.2" data-path="some-examples.html"><a href="some-examples.html#polling"><i class="fa fa-check"></i><b>31.1.2</b> Polling</a></li>
</ul></li>
<li class="chapter" data-level="31.2" data-path="bayesian-poststratification.html"><a href="bayesian-poststratification.html"><i class="fa fa-check"></i><b>31.2</b> Bayesian poststratification</a></li>
<li class="chapter" data-level="31.3" data-path="poststratification-in-stan.html"><a href="poststratification-in-stan.html"><i class="fa fa-check"></i><b>31.3</b> Poststratification in Stan</a></li>
<li class="chapter" data-level="31.4" data-path="regression-and-poststratification.html"><a href="regression-and-poststratification.html"><i class="fa fa-check"></i><b>31.4</b> Regression and poststratification</a></li>
<li class="chapter" data-level="31.5" data-path="multilevel-regression-and-poststratification.html"><a href="multilevel-regression-and-poststratification.html"><i class="fa fa-check"></i><b>31.5</b> Multilevel regression and poststratification</a>
<ul>
<li class="chapter" data-level="31.5.1" data-path="multilevel-regression-and-poststratification.html"><a href="multilevel-regression-and-poststratification.html#dealing-with-small-partitions-and-non-identifiability"><i class="fa fa-check"></i><b>31.5.1</b> Dealing with small partitions and non-identifiability</a></li>
</ul></li>
<li class="chapter" data-level="31.6" data-path="coding-mrp-in-stan.html"><a href="coding-mrp-in-stan.html"><i class="fa fa-check"></i><b>31.6</b> Coding MRP in Stan</a>
<ul>
<li class="chapter" data-level="31.6.1" data-path="coding-mrp-in-stan.html"><a href="coding-mrp-in-stan.html#binomial-coding"><i class="fa fa-check"></i><b>31.6.1</b> Binomial coding</a></li>
<li class="chapter" data-level="31.6.2" data-path="coding-mrp-in-stan.html"><a href="coding-mrp-in-stan.html#coding-binary-groups"><i class="fa fa-check"></i><b>31.6.2</b> Coding binary groups</a></li>
</ul></li>
<li class="chapter" data-level="31.7" data-path="adding-group-level-predictors.html"><a href="adding-group-level-predictors.html"><i class="fa fa-check"></i><b>31.7</b> Adding group-level predictors</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="decision-analysis.html"><a href="decision-analysis.html"><i class="fa fa-check"></i><b>32</b> Decision Analysis</a>
<ul>
<li class="chapter" data-level="32.1" data-path="outline-of-decision-analysis.html"><a href="outline-of-decision-analysis.html"><i class="fa fa-check"></i><b>32.1</b> Outline of decision analysis</a></li>
<li class="chapter" data-level="32.2" data-path="example-decision-analysis.html"><a href="example-decision-analysis.html"><i class="fa fa-check"></i><b>32.2</b> Example decision analysis</a>
<ul>
<li class="chapter" data-level="" data-path="example-decision-analysis.html"><a href="example-decision-analysis.html#step-1.-define-decisions-and-outcomes"><i class="fa fa-check"></i>Step 1. Define decisions and outcomes</a></li>
<li class="chapter" data-level="" data-path="example-decision-analysis.html"><a href="example-decision-analysis.html#step-2.-define-density-of-outcome-conditioned-on-decision"><i class="fa fa-check"></i>Step 2. Define density of outcome conditioned on decision</a></li>
<li class="chapter" data-level="" data-path="example-decision-analysis.html"><a href="example-decision-analysis.html#step-3.-define-the-utility-function"><i class="fa fa-check"></i>Step 3. Define the utility function</a></li>
<li class="chapter" data-level="" data-path="example-decision-analysis.html"><a href="example-decision-analysis.html#step-4.-maximize-expected-utility"><i class="fa fa-check"></i>Step 4. Maximize expected utility</a></li>
</ul></li>
<li class="chapter" data-level="32.3" data-path="continuous-choices.html"><a href="continuous-choices.html"><i class="fa fa-check"></i><b>32.3</b> Continuous choices</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="the-bootstrap-and-bagging.html"><a href="the-bootstrap-and-bagging.html"><i class="fa fa-check"></i><b>33</b> The Bootstrap and Bagging</a>
<ul>
<li class="chapter" data-level="33.1" data-path="the-bootstrap.html"><a href="the-bootstrap.html"><i class="fa fa-check"></i><b>33.1</b> The bootstrap</a>
<ul>
<li class="chapter" data-level="33.1.1" data-path="the-bootstrap.html"><a href="the-bootstrap.html#estimators"><i class="fa fa-check"></i><b>33.1.1</b> Estimators</a></li>
<li class="chapter" data-level="33.1.2" data-path="the-bootstrap.html"><a href="the-bootstrap.html#the-bootstrap-in-pseudocode"><i class="fa fa-check"></i><b>33.1.2</b> The bootstrap in pseudocode</a></li>
</ul></li>
<li class="chapter" data-level="33.2" data-path="coding-the-bootstrap-in-stan.html"><a href="coding-the-bootstrap-in-stan.html"><i class="fa fa-check"></i><b>33.2</b> Coding the bootstrap in Stan</a></li>
<li class="chapter" data-level="33.3" data-path="error-statistics-from-the-bootstrap.html"><a href="error-statistics-from-the-bootstrap.html"><i class="fa fa-check"></i><b>33.3</b> Error statistics from the bootstrap</a>
<ul>
<li class="chapter" data-level="33.3.1" data-path="error-statistics-from-the-bootstrap.html"><a href="error-statistics-from-the-bootstrap.html#standard-errors"><i class="fa fa-check"></i><b>33.3.1</b> Standard errors</a></li>
<li class="chapter" data-level="33.3.2" data-path="error-statistics-from-the-bootstrap.html"><a href="error-statistics-from-the-bootstrap.html#confidence-intervals"><i class="fa fa-check"></i><b>33.3.2</b> Confidence intervals</a></li>
</ul></li>
<li class="chapter" data-level="33.4" data-path="bagging.html"><a href="bagging.html"><i class="fa fa-check"></i><b>33.4</b> Bagging</a></li>
<li class="chapter" data-level="33.5" data-path="bayesian-bootstrap-and-bagging.html"><a href="bayesian-bootstrap-and-bagging.html"><i class="fa fa-check"></i><b>33.5</b> Bayesian bootstrap and bagging</a></li>
</ul></li>
<li><a href="appendices.html#appendices.part"><i style="font-size: 110%; color:#990017;">Appendices</i></a></li>
<li class="chapter" data-level="34" data-path="using-the-stan-compiler.html"><a href="using-the-stan-compiler.html"><i class="fa fa-check"></i><b>34</b> Using the Stan Compiler</a>
<ul>
<li class="chapter" data-level="34.1" data-path="stanc-args.html"><a href="stanc-args.html"><i class="fa fa-check"></i><b>34.1</b> Command-line options for stanc3</a></li>
<li class="chapter" data-level="34.2" data-path="understanding-stanc3-errors-and-warnings.html"><a href="understanding-stanc3-errors-and-warnings.html"><i class="fa fa-check"></i><b>34.2</b> Understanding stanc3 errors and warnings</a>
<ul>
<li class="chapter" data-level="34.2.1" data-path="understanding-stanc3-errors-and-warnings.html"><a href="understanding-stanc3-errors-and-warnings.html#warnings"><i class="fa fa-check"></i><b>34.2.1</b> Warnings</a></li>
<li class="chapter" data-level="34.2.2" data-path="understanding-stanc3-errors-and-warnings.html"><a href="understanding-stanc3-errors-and-warnings.html#errors"><i class="fa fa-check"></i><b>34.2.2</b> Errors</a></li>
</ul></li>
<li class="chapter" data-level="34.3" data-path="pedantic-mode.html"><a href="pedantic-mode.html"><i class="fa fa-check"></i><b>34.3</b> Pedantic mode</a>
<ul>
<li class="chapter" data-level="34.3.1" data-path="pedantic-mode.html"><a href="pedantic-mode.html#distribution-argument-and-variate-constraint-issues"><i class="fa fa-check"></i><b>34.3.1</b> Distribution argument and variate constraint issues</a></li>
<li class="chapter" data-level="34.3.2" data-path="pedantic-mode.html"><a href="pedantic-mode.html#special-case-distribution-issues"><i class="fa fa-check"></i><b>34.3.2</b> Special-case distribution issues</a></li>
<li class="chapter" data-level="34.3.3" data-path="pedantic-mode.html"><a href="pedantic-mode.html#unused-parameters"><i class="fa fa-check"></i><b>34.3.3</b> Unused parameters</a></li>
<li class="chapter" data-level="34.3.4" data-path="pedantic-mode.html"><a href="pedantic-mode.html#large-or-small-constants-in-a-distribution"><i class="fa fa-check"></i><b>34.3.4</b> Large or small constants in a distribution</a></li>
<li class="chapter" data-level="34.3.5" data-path="pedantic-mode.html"><a href="pedantic-mode.html#control-flow-depends-on-a-parameter"><i class="fa fa-check"></i><b>34.3.5</b> Control flow depends on a parameter</a></li>
<li class="chapter" data-level="34.3.6" data-path="pedantic-mode.html"><a href="pedantic-mode.html#parameters-with-multiple-tildes"><i class="fa fa-check"></i><b>34.3.6</b> Parameters with multiple tildes</a></li>
<li class="chapter" data-level="34.3.7" data-path="pedantic-mode.html"><a href="pedantic-mode.html#parameters-with-zero-or-multiple-priors"><i class="fa fa-check"></i><b>34.3.7</b> Parameters with zero or multiple priors</a></li>
<li class="chapter" data-level="34.3.8" data-path="pedantic-mode.html"><a href="pedantic-mode.html#variables-used-before-assignment"><i class="fa fa-check"></i><b>34.3.8</b> Variables used before assignment</a></li>
<li class="chapter" data-level="34.3.9" data-path="pedantic-mode.html"><a href="pedantic-mode.html#strict-or-nonsensical-parameter-bounds"><i class="fa fa-check"></i><b>34.3.9</b> Strict or nonsensical parameter bounds</a></li>
<li class="chapter" data-level="34.3.10" data-path="pedantic-mode.html"><a href="pedantic-mode.html#nonlinear-transformations"><i class="fa fa-check"></i><b>34.3.10</b> Nonlinear transformations</a></li>
<li class="chapter" data-level="34.3.11" data-path="pedantic-mode.html"><a href="pedantic-mode.html#pedantic-mode-limitations"><i class="fa fa-check"></i><b>34.3.11</b> Pedantic mode limitations</a></li>
</ul></li>
<li class="chapter" data-level="34.4" data-path="stanc-pretty-printing.html"><a href="stanc-pretty-printing.html"><i class="fa fa-check"></i><b>34.4</b> Automatic updating and formatting of Stan programs</a>
<ul>
<li class="chapter" data-level="34.4.1" data-path="stanc-pretty-printing.html"><a href="stanc-pretty-printing.html#automatic-formatting"><i class="fa fa-check"></i><b>34.4.1</b> Automatic formatting</a></li>
<li class="chapter" data-level="34.4.2" data-path="stanc-pretty-printing.html"><a href="stanc-pretty-printing.html#canonicalizing"><i class="fa fa-check"></i><b>34.4.2</b> Canonicalizing</a></li>
<li class="chapter" data-level="34.4.3" data-path="stanc-pretty-printing.html"><a href="stanc-pretty-printing.html#known-issues"><i class="fa fa-check"></i><b>34.4.3</b> Known issues</a></li>
</ul></li>
<li class="chapter" data-level="34.5" data-path="optimization.html"><a href="optimization.html#optimization"><i class="fa fa-check"></i><b>34.5</b> Optimization</a>
<ul>
<li class="chapter" data-level="34.5.1" data-path="optimization.html"><a href="optimization.html#optimization-levels"><i class="fa fa-check"></i><b>34.5.1</b> Optimization levels</a></li>
<li class="chapter" data-level="34.5.2" data-path="optimization.html"><a href="optimization.html#o1-optimizations"><i class="fa fa-check"></i><b>34.5.2</b> <strong>O1</strong> Optimizations</a></li>
<li class="chapter" data-level="34.5.3" data-path="optimization.html"><a href="optimization.html#oexperimental-optimizations"><i class="fa fa-check"></i><b>34.5.3</b> <strong>Oexperimental</strong> Optimizations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="35" data-path="stan-program-style-guide.html"><a href="stan-program-style-guide.html"><i class="fa fa-check"></i><b>35</b> Stan Program Style Guide</a>
<ul>
<li class="chapter" data-level="35.1" data-path="choose-a-consistent-style.html"><a href="choose-a-consistent-style.html"><i class="fa fa-check"></i><b>35.1</b> Choose a consistent style</a></li>
<li class="chapter" data-level="35.2" data-path="line-length.html"><a href="line-length.html"><i class="fa fa-check"></i><b>35.2</b> Line length</a></li>
<li class="chapter" data-level="35.3" data-path="file-extensions.html"><a href="file-extensions.html"><i class="fa fa-check"></i><b>35.3</b> File extensions</a></li>
<li class="chapter" data-level="35.4" data-path="variable-naming.html"><a href="variable-naming.html"><i class="fa fa-check"></i><b>35.4</b> Variable naming</a></li>
<li class="chapter" data-level="35.5" data-path="local-variable-scope.html"><a href="local-variable-scope.html"><i class="fa fa-check"></i><b>35.5</b> Local variable scope</a></li>
<li class="chapter" data-level="35.6" data-path="parentheses-and-brackets.html"><a href="parentheses-and-brackets.html"><i class="fa fa-check"></i><b>35.6</b> Parentheses and brackets</a>
<ul>
<li class="chapter" data-level="" data-path="parentheses-and-brackets.html"><a href="parentheses-and-brackets.html#braces-for-single-statement-blocks"><i class="fa fa-check"></i>Braces for single-statement blocks</a></li>
<li class="chapter" data-level="" data-path="parentheses-and-brackets.html"><a href="parentheses-and-brackets.html#parentheses-in-nested-operator-expressions"><i class="fa fa-check"></i>Parentheses in nested operator expressions</a></li>
<li class="chapter" data-level="" data-path="parentheses-and-brackets.html"><a href="parentheses-and-brackets.html#no-open-brackets-on-own-line"><i class="fa fa-check"></i>No open brackets on own line</a></li>
</ul></li>
<li class="chapter" data-level="35.7" data-path="conditionals.html"><a href="conditionals.html"><i class="fa fa-check"></i><b>35.7</b> Conditionals</a></li>
<li class="chapter" data-level="35.8" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>35.8</b> Functions</a></li>
<li class="chapter" data-level="35.9" data-path="white-space.html"><a href="white-space.html"><i class="fa fa-check"></i><b>35.9</b> White space</a>
<ul>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#line-breaks-between-statements-and-declarations"><i class="fa fa-check"></i>Line breaks between statements and declarations</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#no-tabs"><i class="fa fa-check"></i>No tabs</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#two-character-indents"><i class="fa fa-check"></i>Two-character indents</a></li>
<li class="chapter" data-level="35.9.1" data-path="white-space.html"><a href="white-space.html#space-between-if-and-condition"><i class="fa fa-check"></i><b>35.9.1</b> Space between <code>if</code>, <code>{</code> and condition</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#no-space-for-function-calls"><i class="fa fa-check"></i>No space for function calls</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#spaces-around-operators"><i class="fa fa-check"></i>Spaces around operators</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#no-spaces-in-type-constraints"><i class="fa fa-check"></i>No spaces in type constraints</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#breaking-expressions-across-lines"><i class="fa fa-check"></i>Breaking expressions across lines</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#spaces-after-commas"><i class="fa fa-check"></i>Spaces after commas</a></li>
<li class="chapter" data-level="" data-path="white-space.html"><a href="white-space.html#unix-newlines"><i class="fa fa-check"></i>Unix newlines</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="36" data-path="stan-for-bugs.html"><a href="stan-for-bugs.html"><i class="fa fa-check"></i><b>36</b> Transitioning from BUGS</a>
<ul>
<li class="chapter" data-level="36.1" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html"><i class="fa fa-check"></i><b>36.1</b> Some differences in how BUGS and Stan work</a>
<ul>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#bugs-is-interpreted-stan-is-compiled"><i class="fa fa-check"></i>BUGS is interpreted, Stan is compiled</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#bugs-performs-mcmc-updating-one-scalar-parameter-at-a-time-stan-uses-hmc-which-moves-in-the-entire-space-of-all-the-parameters-at-each-step"><i class="fa fa-check"></i>BUGS performs MCMC updating one scalar parameter at a time, Stan uses HMC which moves in the entire space of all the parameters at each step</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#differences-in-tuning-during-warmup"><i class="fa fa-check"></i>Differences in tuning during warmup</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#the-stan-language-is-directly-executable-the-bugs-modeling-language-is-not"><i class="fa fa-check"></i>The Stan language is directly executable, the BUGS modeling language is not</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#differences-in-statement-order"><i class="fa fa-check"></i>Differences in statement order</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#stan-computes-the-gradient-of-the-log-density-bugs-computes-the-log-density-but-not-its-gradient"><i class="fa fa-check"></i>Stan computes the gradient of the log density, BUGS computes the log density but not its gradient</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#both-bugs-and-stan-are-semi-automatic"><i class="fa fa-check"></i>Both BUGS and Stan are semi-automatic</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#licensing"><i class="fa fa-check"></i>Licensing</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#interfaces"><i class="fa fa-check"></i>Interfaces</a></li>
<li class="chapter" data-level="" data-path="some-differences-in-how-bugs-and-stan-work.html"><a href="some-differences-in-how-bugs-and-stan-work.html#platforms"><i class="fa fa-check"></i>Platforms</a></li>
</ul></li>
<li class="chapter" data-level="36.2" data-path="some-differences-in-the-modeling-languages.html"><a href="some-differences-in-the-modeling-languages.html"><i class="fa fa-check"></i><b>36.2</b> Some differences in the modeling languages</a></li>
<li class="chapter" data-level="36.3" data-path="some-differences-in-the-statistical-models-that-are-allowed.html"><a href="some-differences-in-the-statistical-models-that-are-allowed.html"><i class="fa fa-check"></i><b>36.3</b> Some differences in the statistical models that are allowed</a></li>
<li class="chapter" data-level="36.4" data-path="some-differences-when-running-from-r.html"><a href="some-differences-when-running-from-r.html"><i class="fa fa-check"></i><b>36.4</b> Some differences when running from R</a></li>
<li class="chapter" data-level="36.5" data-path="the-stan-community.html"><a href="the-stan-community.html"><i class="fa fa-check"></i><b>36.5</b> The Stan community</a></li>
</ul></li>
<li><a href="references.html#references"><i style="font-size: 110%; color:#990017;">References</i></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stan User’s Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">

<div>
This is an old version, <a href="https://mc-stan.org/docs/stan-users-guide/regression.html#multivariate-hierarchical-priors.section">view current version</a>.
</div>
<div id="multivariate-hierarchical-priors.section" class="section level2" number="1.13">
<h2><span class="header-section-number">1.13</span> Multivariate priors for hierarchical models</h2>
<p>In hierarchical regression models (and other situations), several
individual-level variables may be assigned hierarchical priors. For
example, a model with multiple varying intercepts and slopes within
might assign them a multivariate prior.</p>
<p>As an example, the individuals might be people and the outcome income,
with predictors such as education level and age, and the groups might be states
or other geographic divisions. The effect of education level and age
as well as an intercept might be allowed to vary by state.
Furthermore, there might be state-level predictors, such as average
state income and unemployment level.</p>
<div id="multivariate-regression-example" class="section level3 unnumbered">
<h3>Multivariate regression example</h3>
<p><span class="citation"><a href="#ref-GelmanHill:2007" role="doc-biblioref">Andrew Gelman and Hill</a> (<a href="#ref-GelmanHill:2007" role="doc-biblioref">2007, chap. 13</a>, Chapter 17)</span> provide a discussion of a
hierarchical model with <span class="math inline">\(N\)</span> individuals organized into <span class="math inline">\(J\)</span> groups.
Each individual has a predictor row vector <span class="math inline">\(x_n\)</span> of size <span class="math inline">\(K\)</span>; to unify
the notation, they assume that <span class="math inline">\(x_{n,1} = 1\)</span> is a fixed “intercept”
predictor. To encode group membership, they assume individual <span class="math inline">\(n\)</span>
belongs to group <span class="math inline">\(jj[n] \in \{ 1, \dotsc, J \}\)</span>. Each individual <span class="math inline">\(n\)</span> also has an
observed outcome <span class="math inline">\(y_n\)</span> taking on real values.</p>
<div id="likelihood" class="section level4 unnumbered">
<h4>Likelihood</h4>
<p>The model is a linear regression with slope and intercept coefficients
varying by group, so that <span class="math inline">\(\beta_j\)</span> is the coefficient <span class="math inline">\(K\)</span>-vector for
group <span class="math inline">\(j\)</span>. The likelihood function for individual <span class="math inline">\(n\)</span> is then just
<span class="math display">\[
y_n \sim \textsf{normal}(x_n \, \beta_{jj[n]}, \, \sigma)
\quad\text{for}\quad n \in \{ 1, \dotsc, N \}.
\]</span></p>
</div>
<div id="coefficient-prior" class="section level4 unnumbered">
<h4>Coefficient prior</h4>
<p>Gelman and Hill model the coefficient vectors <span class="math inline">\(\beta_j\)</span> as being drawn
from a multivariate distribution with mean vector <span class="math inline">\(\mu\)</span> and
covariance matrix <span class="math inline">\(\Sigma\)</span>,
<span class="math display">\[
\beta_j \sim \textsf{multivariate normal}(\mu_j, \, \Sigma)
\quad\text{for}\quad j \in \{ 1, \dotsc, J \}.
\]</span></p>
<p>Below, we discuss the full model of Gelman and Hill, which uses
group-level predictors to model <span class="math inline">\(\mu\)</span>; for now, we assume <span class="math inline">\(\mu\)</span> is a
simple vector parameter.</p>
</div>
<div id="hyperpriors" class="section level4 unnumbered">
<h4>Hyperpriors</h4>
<p>For hierarchical modeling, the group-level mean vector <span class="math inline">\(\mu\)</span> and
covariance matrix <span class="math inline">\(\Sigma\)</span> must themselves be given priors. The
group-level mean vector can be given a reasonable weakly-informative
prior for independent coefficients, such as
<span class="math display">\[
\mu_j \sim \textsf{normal}(0,5).
\]</span>
If more is known about the expected coefficient values
<span class="math inline">\(\beta_{j, k}\)</span>, this information can be incorporated into the prior for
<span class="math inline">\(\mu_j\)</span>.</p>
<p>For the prior on the covariance matrix, Gelman and Hill suggest using
a scaled inverse Wishart. That choice was motivated primarily by
convenience as it is conjugate to the multivariate likelihood function
and thus simplifies Gibbs sampling</p>
<p>In Stan, there is no restriction to conjugacy for multivariate priors,
and we in fact recommend a slightly different approach. Like Gelman
and Hill, we decompose our prior into a scale and a matrix, but are
able to do so in a more natural way based on the actual variable
scales and a correlation matrix. Specifically, we define
<span class="math display">\[
\Sigma = \texttt{diag}\mathtt{\_}\texttt{matrix}(\tau) \times \Omega \times \texttt{diag}\mathtt{\_}\texttt{matrix}(\tau),
\]</span>
where <span class="math inline">\(\Omega\)</span> is a correlation matrix and <span class="math inline">\(\tau\)</span> is the vector of
coefficient scales. This mapping from scale vector <span class="math inline">\(\tau\)</span> and
correlation matrix <span class="math inline">\(\Omega\)</span> can be inverted, using
<span class="math display">\[
\tau_k = \sqrt{\Sigma_{k,k}}
\quad\textsf{and}\quad
\Omega_{i, j} = \frac{\Sigma_{i, j}}{\tau_i \, \tau_j}.
\]</span></p>
<p>The components of the scale vector <span class="math inline">\(\tau\)</span> can be given any reasonable
prior for scales, but we recommend something weakly informative like a
half-Cauchy distribution with a small scale, such as
<span class="math display">\[
\tau_k \sim \textsf{Cauchy}(0, 2.5)
\quad\text{for}\quad k \in \{ 1, \dotsc, K \}
\quad\text{constrained\ by}\quad \tau_k &gt; 0.
\]</span>
As for the prior means, if there is information about the scale of
variation of coefficients across groups, it should be incorporated
into the prior for <span class="math inline">\(\tau\)</span>. For large numbers of exchangeable
coefficients, the components of <span class="math inline">\(\tau\)</span> itself (perhaps excluding the
intercept) may themselves be given a hierarchical prior.</p>
<p>Our final recommendation is to give the correlation matrix <span class="math inline">\(\Omega\)</span> an
LKJ prior with shape <span class="math inline">\(\eta \geq 1\)</span>,<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p><span class="math display">\[
\Omega \sim \textsf{LKJCorr}(\eta).
\]</span></p>
<p>The LKJ correlation distribution is defined by
<span class="math display">\[
\textsf{LKJCorr}\left(\Sigma \mid \eta\right)
\propto
\operatorname{det}\left(\Sigma\right)^{\eta - 1}.
\]</span></p>
<p>The basic behavior of the LKJ correlation distribution is similar to
that of a beta distribution. For <span class="math inline">\(\eta = 1\)</span>, the result is a uniform
distribution. Despite being the identity over correlation matrices, the
marginal distribution over the entries in that matrix (i.e., the
correlations) is not uniform between -1 and 1. Rather, it
concentrates around zero as the dimensionality increases due to the
complex constraints.</p>
<p>For <span class="math inline">\(\eta &gt; 1\)</span>, the density increasingly concentrates
mass around the unit matrix, i.e., favoring less correlation. For
<span class="math inline">\(\eta &lt; 1\)</span>, it increasingly concentrates mass in the other direction,
i.e., favoring more correlation.</p>
<p>The LKJ prior may thus be used to control the expected amount of
correlation among the parameters <span class="math inline">\(\beta_j\)</span>. For a discussion of
decomposing a covariance prior into a prior on correlation matrices
and an independent prior on scales, see <span class="citation"><a href="#ref-barnard-mcculloch-meng:2000" role="doc-biblioref">Barnard, McCulloch, and Meng</a> (<a href="#ref-barnard-mcculloch-meng:2000" role="doc-biblioref">2000</a>)</span>.</p>
</div>
<div id="group-level-predictors-for-prior-mean" class="section level4 unnumbered">
<h4>Group-level predictors for prior mean</h4>
<p>To complete Gelman and Hill’s model, suppose each group <span class="math inline">\(j \in \{ 1, \dotsc, J \}\)</span>
is supplied with an <span class="math inline">\(L\)</span>-dimensional row-vector of group-level
predictors <span class="math inline">\(u_j\)</span>. The prior mean for the <span class="math inline">\(\beta_j\)</span> can then itself be
modeled as a regression, using an <span class="math inline">\(L\)</span>-dimensional coefficient vector
<span class="math inline">\(\gamma\)</span>. The prior for the group-level coefficients then becomes
<span class="math display">\[
\beta_j \sim \textsf{multivariate normal}(u_j \, \gamma, \Sigma)
\]</span></p>
<p>The group-level coefficients <span class="math inline">\(\gamma\)</span> may themselves be given
independent weakly informative priors, such as
<span class="math display">\[
\gamma_l \sim \textsf{normal}(0,5).
\]</span>
As usual, information about the group-level means should be
incorporated into this prior.</p>
</div>
<div id="coding-the-model-in-stan" class="section level4 unnumbered">
<h4>Coding the model in Stan</h4>
<p>The Stan code for the full hierarchical model with multivariate priors
on the group-level coefficients and group-level prior means follows
its definition.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb39-1"><a href="multivariate-hierarchical-priors.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb39-2"><a href="multivariate-hierarchical-priors.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; N;              <span class="co">// num individuals</span></span>
<span id="cb39-3"><a href="multivariate-hierarchical-priors.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; K;              <span class="co">// num ind predictors</span></span>
<span id="cb39-4"><a href="multivariate-hierarchical-priors.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; J;              <span class="co">// num groups</span></span>
<span id="cb39-5"><a href="multivariate-hierarchical-priors.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; L;              <span class="co">// num group predictors</span></span>
<span id="cb39-6"><a href="multivariate-hierarchical-priors.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[N] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=J&gt; jj;  <span class="co">// group for individual</span></span>
<span id="cb39-7"><a href="multivariate-hierarchical-priors.html#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[N, K] x;              <span class="co">// individual predictors</span></span>
<span id="cb39-8"><a href="multivariate-hierarchical-priors.html#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[J] <span class="dt">row_vector</span>[L] u;    <span class="co">// group predictors</span></span>
<span id="cb39-9"><a href="multivariate-hierarchical-priors.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] y;                 <span class="co">// outcomes</span></span>
<span id="cb39-10"><a href="multivariate-hierarchical-priors.html#cb39-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-11"><a href="multivariate-hierarchical-priors.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb39-12"><a href="multivariate-hierarchical-priors.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">corr_matrix</span>[K] Omega;        <span class="co">// prior correlation</span></span>
<span id="cb39-13"><a href="multivariate-hierarchical-priors.html#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt;[K] tau;      <span class="co">// prior scale</span></span>
<span id="cb39-14"><a href="multivariate-hierarchical-priors.html#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[L, K] gamma;          <span class="co">// group coeffs</span></span>
<span id="cb39-15"><a href="multivariate-hierarchical-priors.html#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[J] <span class="dt">vector</span>[K] beta;     <span class="co">// indiv coeffs by group</span></span>
<span id="cb39-16"><a href="multivariate-hierarchical-priors.html#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;         <span class="co">// prediction error scale</span></span>
<span id="cb39-17"><a href="multivariate-hierarchical-priors.html#cb39-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-18"><a href="multivariate-hierarchical-priors.html#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb39-19"><a href="multivariate-hierarchical-priors.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  tau ~ cauchy(<span class="dv">0</span>, <span class="fl">2.5</span>);</span>
<span id="cb39-20"><a href="multivariate-hierarchical-priors.html#cb39-20" aria-hidden="true" tabindex="-1"></a>  Omega ~ lkj_corr(<span class="dv">2</span>);</span>
<span id="cb39-21"><a href="multivariate-hierarchical-priors.html#cb39-21" aria-hidden="true" tabindex="-1"></a>  to_vector(gamma) ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb39-22"><a href="multivariate-hierarchical-priors.html#cb39-22" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb39-23"><a href="multivariate-hierarchical-priors.html#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">array</span>[J] <span class="dt">row_vector</span>[K] u_gamma;</span>
<span id="cb39-24"><a href="multivariate-hierarchical-priors.html#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span>:J) {</span>
<span id="cb39-25"><a href="multivariate-hierarchical-priors.html#cb39-25" aria-hidden="true" tabindex="-1"></a>      u_gamma[j] = u[j] * gamma;</span>
<span id="cb39-26"><a href="multivariate-hierarchical-priors.html#cb39-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-27"><a href="multivariate-hierarchical-priors.html#cb39-27" aria-hidden="true" tabindex="-1"></a>    beta ~ multi_normal(u_gamma, quad_form_diag(Omega, tau));</span>
<span id="cb39-28"><a href="multivariate-hierarchical-priors.html#cb39-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-29"><a href="multivariate-hierarchical-priors.html#cb39-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb39-30"><a href="multivariate-hierarchical-priors.html#cb39-30" aria-hidden="true" tabindex="-1"></a>    y[n] ~ normal(x[n] * beta[jj[n]], sigma);</span>
<span id="cb39-31"><a href="multivariate-hierarchical-priors.html#cb39-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-32"><a href="multivariate-hierarchical-priors.html#cb39-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The hyperprior covariance matrix is defined implicitly through the a
quadratic form in the code because the correlation matrix <code>Omega</code> and
scale vector <code>tau</code> are more natural to inspect in the output; to
output <code>Sigma</code>, define it as a transformed parameter. The function
<code>quad_form_diag</code> is defined so that <code>quad_form_diag(Sigma, tau)</code> is
equivalent to <code>diag_matrix(tau) * Sigma * diag_matrix(tau)</code>, where
<code>diag_matrix(tau)</code> returns the matrix with <code>tau</code> on the diagonal and
zeroes off diagonal; the version using <code>quad_form_diag</code> should be
faster. For details on these and other matrix arithmetic operators and
functions, see the function reference manual.</p>
</div>
<div id="optimization-through-vectorization" class="section level4 unnumbered">
<h4>Optimization through vectorization</h4>
<p>The code in the Stan program above can be sped up dramatically by replacing:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb40-1"><a href="multivariate-hierarchical-priors.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb40-2"><a href="multivariate-hierarchical-priors.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  y[n] ~ normal(x[n] * beta[jj[n]], sigma);</span>
<span id="cb40-3"><a href="multivariate-hierarchical-priors.html#cb40-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>with the vectorized form:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb41-1"><a href="multivariate-hierarchical-priors.html#cb41-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb41-2"><a href="multivariate-hierarchical-priors.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] x_beta_jj;</span>
<span id="cb41-3"><a href="multivariate-hierarchical-priors.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb41-4"><a href="multivariate-hierarchical-priors.html#cb41-4" aria-hidden="true" tabindex="-1"></a>    x_beta_jj[n] = x[n] * beta[jj[n]];</span>
<span id="cb41-5"><a href="multivariate-hierarchical-priors.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-6"><a href="multivariate-hierarchical-priors.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  y ~ normal(x_beta_jj, sigma);</span>
<span id="cb41-7"><a href="multivariate-hierarchical-priors.html#cb41-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The outer brackets create a local scope in which to define the
variable <code>x_beta_jj</code>, which is then filled in a loop and used
to define a vectorized sampling statement. The reason this is such a
big win is that it allows us to take the log of sigma only once and it
greatly reduces the size of the resulting expression graph by packing
all of the work into a single density function.</p>
<p>Although it is tempting to redeclare <code>beta</code> and include a revised
model block sampling statement,</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb42-1"><a href="multivariate-hierarchical-priors.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb42-2"><a href="multivariate-hierarchical-priors.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[J, K] beta;</span>
<span id="cb42-3"><a href="multivariate-hierarchical-priors.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb42-4"><a href="multivariate-hierarchical-priors.html#cb42-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-5"><a href="multivariate-hierarchical-priors.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb42-6"><a href="multivariate-hierarchical-priors.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  y ~ normal(rows_dot_product(x, beta[jj]), sigma);</span>
<span id="cb42-7"><a href="multivariate-hierarchical-priors.html#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb42-8"><a href="multivariate-hierarchical-priors.html#cb42-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>this fails because it breaks the vectorization of sampling for
<code>beta</code>,<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb43-1"><a href="multivariate-hierarchical-priors.html#cb43-1" aria-hidden="true" tabindex="-1"></a>beta ~ multi_normal(...);</span></code></pre></div>
<p>which requires <code>beta</code> to be an array of vectors. Both
vectorizations are important, so the best solution is to just use the
loop above, because <code>rows_dot_product</code> cannot do much
optimization in and of itself because there are no shared computations.</p>
<p>The code in the Stan program above also builds up an array of vectors
for the outcomes and for the multivariate normal, which provides a
major speedup by reducing the number of linear systems that
need to be solved and differentiated.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb44-1"><a href="multivariate-hierarchical-priors.html#cb44-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb44-2"><a href="multivariate-hierarchical-priors.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[K, K] Sigma_beta;</span>
<span id="cb44-3"><a href="multivariate-hierarchical-priors.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  Sigma_beta = quad_form_diag(Omega, tau);</span>
<span id="cb44-4"><a href="multivariate-hierarchical-priors.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span>:J) {</span>
<span id="cb44-5"><a href="multivariate-hierarchical-priors.html#cb44-5" aria-hidden="true" tabindex="-1"></a>    beta[j] ~ multi_normal((u[j] * gamma)&#39;, Sigma_beta);</span>
<span id="cb44-6"><a href="multivariate-hierarchical-priors.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-7"><a href="multivariate-hierarchical-priors.html#cb44-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In this example, the covariance matrix <code>Sigma_beta</code> is defined
as a local variable so as not to have to repeat the quadratic form
computation <span class="math inline">\(J\)</span> times. This vectorization can be combined with the
Cholesky-factor optimization in the next section.</p>
</div>
<div id="optimization-through-cholesky-factorization" class="section level4 unnumbered">
<h4>Optimization through Cholesky factorization</h4>
<p>The multivariate normal density and LKJ prior on correlation matrices
both require their matrix parameters to be factored. Vectorizing, as
in the previous section, ensures this is only done once for each
density. An even better solution, both in terms of efficiency and
numerical stability, is to parameterize the model directly in terms of
Cholesky factors of correlation matrices using the multivariate
version of the non-centered parameterization. For the model in the
previous section, the program fragment to replace the full matrix
prior with an equivalent Cholesky factorized prior is as follows.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb45-1"><a href="multivariate-hierarchical-priors.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb45-2"><a href="multivariate-hierarchical-priors.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[L, J] u;              <span class="co">// group predictors transposed</span></span>
<span id="cb45-3"><a href="multivariate-hierarchical-priors.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb45-4"><a href="multivariate-hierarchical-priors.html#cb45-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-5"><a href="multivariate-hierarchical-priors.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb45-6"><a href="multivariate-hierarchical-priors.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[K, J] z;</span>
<span id="cb45-7"><a href="multivariate-hierarchical-priors.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">cholesky_factor_corr</span>[K] L_Omega;</span>
<span id="cb45-8"><a href="multivariate-hierarchical-priors.html#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[K, L] gamma;</span>
<span id="cb45-9"><a href="multivariate-hierarchical-priors.html#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb45-10"><a href="multivariate-hierarchical-priors.html#cb45-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-11"><a href="multivariate-hierarchical-priors.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb45-12"><a href="multivariate-hierarchical-priors.html#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[K, J] beta;</span>
<span id="cb45-13"><a href="multivariate-hierarchical-priors.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  beta = gamma * u + diag_pre_multiply(tau, L_Omega) * z;</span>
<span id="cb45-14"><a href="multivariate-hierarchical-priors.html#cb45-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-15"><a href="multivariate-hierarchical-priors.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb45-16"><a href="multivariate-hierarchical-priors.html#cb45-16" aria-hidden="true" tabindex="-1"></a>  to_vector(z) ~ std_normal();</span>
<span id="cb45-17"><a href="multivariate-hierarchical-priors.html#cb45-17" aria-hidden="true" tabindex="-1"></a>  L_Omega ~ lkj_corr_cholesky(<span class="dv">2</span>);</span>
<span id="cb45-18"><a href="multivariate-hierarchical-priors.html#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span>
<span id="cb45-19"><a href="multivariate-hierarchical-priors.html#cb45-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The data variable <code>u</code> was originally an array of vectors, which
is efficient for access; here it is redeclared as a matrix in order to
use it in matrix arithmetic. Moreover, it is transposed, along with
<code>gamma</code> and <code>beta</code>, to minimize the number of transposition operations.
The new parameter <code>L_Omega</code> is the Cholesky factor of the original
correlation matrix <code>Omega</code>, so that</p>
<pre><code>Omega = L_Omega * L_Omega&#39;</code></pre>
<p>The prior scale vector <code>tau</code> is unchanged, and furthermore,
pre-multiplying the Cholesky factor by the scale produces the Cholesky
factor of the final covariance matrix,</p>
<pre><code>Sigma_beta
  = quad_form_diag(Omega, tau)
  = diag_pre_multiply(tau, L_Omega) * diag_pre_multiply(tau, L_Omega)&#39;</code></pre>
<p>where the diagonal pre-multiply compound operation is defined by</p>
<pre><code>diag_pre_multiply(a, b) = diag_matrix(a) * b</code></pre>
<p>The new variable <code>z</code> is declared as a matrix, the entries of
which are given independent standard normal priors; the <code>to_vector</code>
operation turns the matrix into a vector so that it can be used as a
vectorized argument to the univariate normal density. This results in every
column of <code>z</code> being a <span class="math inline">\(K\)</span>-variate normal random vector with the identity as
covariance matrix. Therefore, multiplying <code>z</code> by the Cholesky factor of the
covariance matrix and adding the mean <code>(u * gamma)'</code> produces a <code>beta</code>
distributed as in the original model, where the variance is,
letting <span class="math inline">\(L = \mathrm{diag}(\tau)\,\Omega_L\)</span>,</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{V}[\beta] &amp;= \mathbb{E}\big((L \, z)(L \, z)^\top) \\
&amp;= \mathbb{E}\big((L \, z \, z^\top \, L^\top) \\
&amp;= L \, \mathbb{E}(z \, z^\top) \, L^\top \\
&amp;= L \, L^\top =(\mathrm{diag}(\tau)\,\Omega_L)\,(\mathrm{diag}(\tau)\,\Omega_L)^\top \\
&amp;= \mathrm{diag}(\tau)\,\Omega\,\mathrm{diag}(\tau) \\
&amp;= \Sigma.
\end{aligned}
\]</span>
Where we have used the linearity of expectations (line 2 to 3),
the definition of <span class="math inline">\(\Omega = \Omega_L \, \Omega_L^\top\)</span>, and the
fact that <span class="math inline">\(\mathbb{E}(z \, z^\top) = I\)</span> since <span class="math inline">\(z \sim \mathcal{N}(0, I)\)</span>.</p>
<p>Omitting the remaining data declarations, which are the same as before
with the exception of <code>u</code>, the optimized model is as follows.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb49-1"><a href="multivariate-hierarchical-priors.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb49-2"><a href="multivariate-hierarchical-priors.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[K, J] z;</span>
<span id="cb49-3"><a href="multivariate-hierarchical-priors.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">cholesky_factor_corr</span>[K] L_Omega;</span>
<span id="cb49-4"><a href="multivariate-hierarchical-priors.html#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=pi() / <span class="dv">2</span>&gt;[K] tau_unif;  <span class="co">// prior scale</span></span>
<span id="cb49-5"><a href="multivariate-hierarchical-priors.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[K, L] gamma;                        <span class="co">// group coeffs</span></span>
<span id="cb49-6"><a href="multivariate-hierarchical-priors.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma;                       <span class="co">// prediction error scale</span></span>
<span id="cb49-7"><a href="multivariate-hierarchical-priors.html#cb49-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-8"><a href="multivariate-hierarchical-priors.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb49-9"><a href="multivariate-hierarchical-priors.html#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt;[K] tau = <span class="fl">2.5</span> * tan(tau_unif);</span>
<span id="cb49-10"><a href="multivariate-hierarchical-priors.html#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[K, J] beta = gamma * u + diag_pre_multiply(tau, L_Omega) * z;</span>
<span id="cb49-11"><a href="multivariate-hierarchical-priors.html#cb49-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-12"><a href="multivariate-hierarchical-priors.html#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb49-13"><a href="multivariate-hierarchical-priors.html#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N] mu;</span>
<span id="cb49-14"><a href="multivariate-hierarchical-priors.html#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(n <span class="cf">in</span> <span class="dv">1</span>:N) {</span>
<span id="cb49-15"><a href="multivariate-hierarchical-priors.html#cb49-15" aria-hidden="true" tabindex="-1"></a>    mu[n] = x[n, ] * beta[, jj[n]];</span>
<span id="cb49-16"><a href="multivariate-hierarchical-priors.html#cb49-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-17"><a href="multivariate-hierarchical-priors.html#cb49-17" aria-hidden="true" tabindex="-1"></a>  to_vector(z) ~ std_normal();</span>
<span id="cb49-18"><a href="multivariate-hierarchical-priors.html#cb49-18" aria-hidden="true" tabindex="-1"></a>  L_Omega ~ lkj_corr_cholesky(<span class="dv">2</span>);</span>
<span id="cb49-19"><a href="multivariate-hierarchical-priors.html#cb49-19" aria-hidden="true" tabindex="-1"></a>  to_vector(gamma) ~ normal(<span class="dv">0</span>, <span class="dv">5</span>);</span>
<span id="cb49-20"><a href="multivariate-hierarchical-priors.html#cb49-20" aria-hidden="true" tabindex="-1"></a>  y ~ normal(mu, sigma);</span>
<span id="cb49-21"><a href="multivariate-hierarchical-priors.html#cb49-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This model also reparameterizes the prior scale <code>tau</code> to avoid
potential problems with the heavy tails of the Cauchy
distribution. The statement <code>tau_unif ~ uniform(0, pi() / 2)</code> can be
omitted from the model block because Stan increments the log posterior
for parameters with uniform priors without it.</p>
</div>
</div>
</div>
<h3><i style="font-size: 110%; color:#990017;">References</i></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-barnard-mcculloch-meng:2000" class="csl-entry">
Barnard, John, Robert McCulloch, and Xiao-Li Meng. 2000. <span>“Modeling Covariance Matrices in Terms of Standard Deviations and Correlations, with Application to Shrinkage.”</span> <em>Statistica Sinica</em>, 1281–311.
</div>
<div id="ref-GelmanHill:2007" class="csl-entry">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data Analysis Using Regression and Multilevel-Hierarchical Models</em>. Cambridge, United Kingdom: Cambridge University Press.
</div>
<div id="ref-LewandowskiKurowickaJoe:2009" class="csl-entry">
Lewandowski, Daniel, Dorota Kurowicka, and Harry Joe. 2009. <span>“Generating Random Correlation Matrices Based on Vines and Extended Onion Method.”</span> <em>Journal of Multivariate Analysis</em> 100: 1989–2001.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>The prior is named for Lewandowski, Kurowicka, and Joe, as it was derived by inverting the random correlation matrix generation strategy of <span class="citation"><a href="#ref-LewandowskiKurowickaJoe:2009" role="doc-biblioref">Lewandowski, Kurowicka, and Joe</a> (<a href="#ref-LewandowskiKurowickaJoe:2009" role="doc-biblioref">2009</a>)</span>.<a href="multivariate-hierarchical-priors.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>Thanks to Mike Lawrence for pointing this out in the GitHub issue for the manual.<a href="multivariate-hierarchical-priors.html#fnref6" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="priors-for-identification.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="prediction-forecasting-and-backcasting.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": "https://github.com/stan-dev/docs/tree/master/src/stan-users-guide/regression.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
