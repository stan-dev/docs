<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>15 stanc: Translating Stan to C++ | CmdStan User’s Guide</title>
  <meta name="description" content="CmdStan user’s guide." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="15 stanc: Translating Stan to C++ | CmdStan User’s Guide" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/logo-tm.pdf" />
  <meta property="og:description" content="CmdStan user’s guide." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="15 stanc: Translating Stan to C++ | CmdStan User’s Guide" />
  
  <meta name="twitter:description" content="CmdStan user’s guide." />
  <meta name="twitter:image" content="img/logo-tm.pdf" />

<meta name="author" content="Stan Development Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cmdstan-tools.html"/>
<link rel="next" href="stansummary.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>



<link rel="stylesheet" href="stan-manual.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li style="font-size:110%; font-weight:400; font-family: Verdana, Helvetica, sans; line-height:1.4; margin: 0.5em 0 0 1em"><a href="https://mc-stan.org/docs/cmdstan-guide/index.html" style="color:#4183C4">CmdStan User's Guide</a></li>

<li class="divider"></li>
<li><a href="index.html#introduction"><i style='font-size: 110%; color:#990017;'>Introduction</i></a></li>
<li><a href="quickstart-guide.html#quickstart-guide"><i style='font-size: 110%; color:#990017;'>QuickStart Guide</i></a></li>
<li class="chapter" data-level="1" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html"><i class="fa fa-check"></i><b>1</b> CmdStan Installation</a><ul>
<li class="chapter" data-level="1.1" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#installing-the-c-toolchain"><i class="fa fa-check"></i><b>1.1</b> Installing the C++ Toolchain</a><ul>
<li class="chapter" data-level="1.1.1" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#linux-g-and-make"><i class="fa fa-check"></i><b>1.1.1</b> Linux: <code>g++</code> and <code>make</code></a></li>
<li class="chapter" data-level="1.1.2" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#macos-clang-and-make"><i class="fa fa-check"></i><b>1.1.2</b> MacOS: <code>clang++</code> and <code>make</code></a></li>
<li class="chapter" data-level="1.1.3" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#windows-make"><i class="fa fa-check"></i><b>1.1.3</b> Windows: <code>g++</code> and <code>mingw32-make</code></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#gnu-make"><i class="fa fa-check"></i><b>1.2</b> GNU-Make Utility</a></li>
<li class="chapter" data-level="1.3" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#git-clone.section"><i class="fa fa-check"></i><b>1.3</b> Clone the GitHub CmdStan Repository</a></li>
<li class="chapter" data-level="1.4" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#building-cmdstan"><i class="fa fa-check"></i><b>1.4</b> Building CmdStan</a></li>
<li class="chapter" data-level="1.5" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#checking-the-stan-compiler"><i class="fa fa-check"></i><b>1.5</b> Checking the Stan compiler</a></li>
<li class="chapter" data-level="1.6" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#troubleshooting-the-installation"><i class="fa fa-check"></i><b>1.6</b> Troubleshooting the installation</a><ul>
<li class="chapter" data-level="1.6.1" data-path="cmdstan-installation.html"><a href="cmdstan-installation.html#common-problems"><i class="fa fa-check"></i><b>1.6.1</b> Common problems</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-model-and-data.html"><a href="example-model-and-data.html"><i class="fa fa-check"></i><b>2</b> Example Model and Data</a></li>
<li class="chapter" data-level="3" data-path="compiling-a-stan-program.html"><a href="compiling-a-stan-program.html"><i class="fa fa-check"></i><b>3</b> Compiling a Stan Program</a><ul>
<li class="chapter" data-level="3.1" data-path="compiling-a-stan-program.html"><a href="compiling-a-stan-program.html#invoking-the-make-utility"><i class="fa fa-check"></i><b>3.1</b> Invoking the Make Utility</a></li>
<li class="chapter" data-level="3.2" data-path="compiling-a-stan-program.html"><a href="compiling-a-stan-program.html#dependencies"><i class="fa fa-check"></i><b>3.2</b> Dependencies</a></li>
<li class="chapter" data-level="3.3" data-path="compiling-a-stan-program.html"><a href="compiling-a-stan-program.html#compiler-errors"><i class="fa fa-check"></i><b>3.3</b> Compiler Errors</a></li>
<li class="chapter" data-level="3.4" data-path="compiling-a-stan-program.html"><a href="compiling-a-stan-program.html#troubleshooting-c-compiler-or-linker-errors"><i class="fa fa-check"></i><b>3.4</b> Troubleshooting C++ Compiler or Linker Errors</a></li>
<li class="chapter" data-level="3.5" data-path="compiling-a-stan-program.html"><a href="compiling-a-stan-program.html#c-compilation-and-linking-optimizations-flags"><i class="fa fa-check"></i><b>3.5</b> C++ compilation and linking optimizations flags</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mcmc-intro.html"><a href="mcmc-intro.html"><i class="fa fa-check"></i><b>4</b> MCMC Sampling</a><ul>
<li class="chapter" data-level="4.1" data-path="mcmc-intro.html"><a href="mcmc-intro.html#running-the-sampler"><i class="fa fa-check"></i><b>4.1</b> Running the Sampler</a></li>
<li class="chapter" data-level="4.2" data-path="mcmc-intro.html"><a href="mcmc-intro.html#running-multiple-chains"><i class="fa fa-check"></i><b>4.2</b> Running Multiple Chains</a></li>
<li class="chapter" data-level="4.3" data-path="mcmc-intro.html"><a href="mcmc-intro.html#mcmc_output_csv"><i class="fa fa-check"></i><b>4.3</b> Stan CSV Output File</a></li>
<li class="chapter" data-level="4.4" data-path="mcmc-intro.html"><a href="mcmc-intro.html#summarizing-sampler-outputs-with-stansummary"><i class="fa fa-check"></i><b>4.4</b> Summarizing Sampler Output(s) with <code>stansummary</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="optimization.html"><a href="optimization.html"><i class="fa fa-check"></i><b>5</b> Optimization</a></li>
<li class="chapter" data-level="6" data-path="variational-inference.html"><a href="variational-inference.html"><i class="fa fa-check"></i><b>6</b> Variational Inference</a></li>
<li class="chapter" data-level="7" data-path="gc-intro.html"><a href="gc-intro.html"><i class="fa fa-check"></i><b>7</b> Generating Quantities of Interest from a Fitted Model</a></li>
<li><a href="reference-manual.html#reference-manual"><i style='font-size: 110%; color:#990017;'>Reference Manual</i></a></li>
<li class="chapter" data-level="8" data-path="command-line-interface-overview.html"><a href="command-line-interface-overview.html"><i class="fa fa-check"></i><b>8</b> Command-Line Interface Overview</a><ul>
<li class="chapter" data-level="8.1" data-path="command-line-interface-overview.html"><a href="command-line-interface-overview.html#input-data-argument"><i class="fa fa-check"></i><b>8.1</b> Input Data Argument</a></li>
<li class="chapter" data-level="8.2" data-path="command-line-interface-overview.html"><a href="command-line-interface-overview.html#output-control-arguments"><i class="fa fa-check"></i><b>8.2</b> Output Control Arguments</a></li>
<li class="chapter" data-level="8.3" data-path="command-line-interface-overview.html"><a href="command-line-interface-overview.html#initialize-model-parameters-argument"><i class="fa fa-check"></i><b>8.3</b> Initialize Model Parameters Argument</a></li>
<li class="chapter" data-level="8.4" data-path="command-line-interface-overview.html"><a href="command-line-interface-overview.html#random-number-generator-arguments"><i class="fa fa-check"></i><b>8.4</b> Random Number Generator Arguments</a></li>
<li class="chapter" data-level="8.5" data-path="command-line-interface-overview.html"><a href="command-line-interface-overview.html#chain-identifier-argument-id"><i class="fa fa-check"></i><b>8.5</b> Chain Identifier Argument: <code>id</code></a></li>
<li class="chapter" data-level="8.6" data-path="command-line-interface-overview.html"><a href="command-line-interface-overview.html#command-line-help"><i class="fa fa-check"></i><b>8.6</b> Command Line Help</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mcmc-config.html"><a href="mcmc-config.html"><i class="fa fa-check"></i><b>9</b> MCMC Sampling using Hamiltonian Monte Carlo</a><ul>
<li class="chapter" data-level="9.1" data-path="mcmc-config.html"><a href="mcmc-config.html#iterations"><i class="fa fa-check"></i><b>9.1</b> Iterations</a></li>
<li class="chapter" data-level="9.2" data-path="mcmc-config.html"><a href="mcmc-config.html#adaptation"><i class="fa fa-check"></i><b>9.2</b> Adaptation</a><ul>
<li class="chapter" data-level="9.2.1" data-path="mcmc-config.html"><a href="mcmc-config.html#step-size-optimization-configuration"><i class="fa fa-check"></i><b>9.2.1</b> Step size optimization configuration</a></li>
<li class="chapter" data-level="9.2.2" data-path="mcmc-config.html"><a href="mcmc-config.html#warmup-schedule-configuration"><i class="fa fa-check"></i><b>9.2.2</b> Warmup schedule configuration</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="mcmc-config.html"><a href="mcmc-config.html#algorithm"><i class="fa fa-check"></i><b>9.3</b> Algorithm</a><ul>
<li class="chapter" data-level="9.3.1" data-path="mcmc-config.html"><a href="mcmc-config.html#samples-from-a-set-of-fixed-parameters"><i class="fa fa-check"></i><b>9.3.1</b> Samples from a set of fixed parameters</a></li>
<li class="chapter" data-level="9.3.2" data-path="mcmc-config.html"><a href="mcmc-config.html#hmc-samplers"><i class="fa fa-check"></i><b>9.3.2</b> HMC samplers</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="mcmc-config.html"><a href="mcmc-config.html#sampler-diag-file"><i class="fa fa-check"></i><b>9.4</b> Sampler Diagnostic File</a></li>
<li class="chapter" data-level="9.5" data-path="mcmc-config.html"><a href="mcmc-config.html#examples"><i class="fa fa-check"></i><b>9.5</b> Examples</a><ul>
<li class="chapter" data-level="9.5.1" data-path="mcmc-config.html"><a href="mcmc-config.html#running-multiple-chains-with-a-specified-rng-seed"><i class="fa fa-check"></i><b>9.5.1</b> Running multiple chains with a specified RNG seed</a></li>
<li class="chapter" data-level="9.5.2" data-path="mcmc-config.html"><a href="mcmc-config.html#changing-the-default-warmup-and-sampling-iterations"><i class="fa fa-check"></i><b>9.5.2</b> Changing the default warmup and sampling iterations</a></li>
<li class="chapter" data-level="9.5.3" data-path="mcmc-config.html"><a href="mcmc-config.html#saving-warmup-draws"><i class="fa fa-check"></i><b>9.5.3</b> Saving warmup draws</a></li>
<li class="chapter" data-level="9.5.4" data-path="mcmc-config.html"><a href="mcmc-config.html#initializing-parameters"><i class="fa fa-check"></i><b>9.5.4</b> Initializing parameters</a></li>
<li class="chapter" data-level="9.5.5" data-path="mcmc-config.html"><a href="mcmc-config.html#specifying-the-metric-and-stepsize"><i class="fa fa-check"></i><b>9.5.5</b> Specifying the metric and stepsize</a></li>
<li class="chapter" data-level="9.5.6" data-path="mcmc-config.html"><a href="mcmc-config.html#changing-the-nuts-hmc-adaptation-parameters"><i class="fa fa-check"></i><b>9.5.6</b> Changing the NUTS-HMC adaptation parameters</a></li>
<li class="chapter" data-level="9.5.7" data-path="mcmc-config.html"><a href="mcmc-config.html#increasing-the-tree-depth"><i class="fa fa-check"></i><b>9.5.7</b> Increasing the tree-depth</a></li>
<li class="chapter" data-level="9.5.8" data-path="mcmc-config.html"><a href="mcmc-config.html#capturing-hamiltonian-diagnostics-and-gradients"><i class="fa fa-check"></i><b>9.5.8</b> Capturing Hamiltonian diagnostics and gradients</a></li>
<li class="chapter" data-level="9.5.9" data-path="mcmc-config.html"><a href="mcmc-config.html#suppressing-progress-updates-to-the-console"><i class="fa fa-check"></i><b>9.5.9</b> Suppressing progress updates to the console</a></li>
<li class="chapter" data-level="9.5.10" data-path="mcmc-config.html"><a href="mcmc-config.html#everything-example"><i class="fa fa-check"></i><b>9.5.10</b> Everything Example</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html"><i class="fa fa-check"></i><b>10</b> Maximum Likelihood Estimation</a><ul>
<li class="chapter" data-level="10.1" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#optimization-algorithms"><i class="fa fa-check"></i><b>10.1</b> Optimization Algorithms</a></li>
<li class="chapter" data-level="10.2" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#the-quasi-newton-optimizers"><i class="fa fa-check"></i><b>10.2</b> The quasi-Newton optimizers</a></li>
<li class="chapter" data-level="10.3" data-path="maximum-likelihood-estimation.html"><a href="maximum-likelihood-estimation.html#the-newton-optimizer"><i class="fa fa-check"></i><b>10.3</b> The Newton optimizer</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="variational-inference-algorithm-advi.html"><a href="variational-inference-algorithm-advi.html"><i class="fa fa-check"></i><b>11</b> Variational Inference Algorithm: ADVI</a><ul>
<li class="chapter" data-level="11.1" data-path="variational-inference-algorithm-advi.html"><a href="variational-inference-algorithm-advi.html#variational-algorithms"><i class="fa fa-check"></i><b>11.1</b> Variational Algorithms</a></li>
<li class="chapter" data-level="11.2" data-path="variational-inference-algorithm-advi.html"><a href="variational-inference-algorithm-advi.html#configuration"><i class="fa fa-check"></i><b>11.2</b> Configuration</a></li>
<li class="chapter" data-level="11.3" data-path="variational-inference-algorithm-advi.html"><a href="variational-inference-algorithm-advi.html#csv-output"><i class="fa fa-check"></i><b>11.3</b> CSV Output</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="standalone-generate-quantities.html"><a href="standalone-generate-quantities.html"><i class="fa fa-check"></i><b>12</b> Standalone Generate Quantities</a></li>
<li class="chapter" data-level="13" data-path="diagnosing-hmc-by-comparison-of-gradients.html"><a href="diagnosing-hmc-by-comparison-of-gradients.html"><i class="fa fa-check"></i><b>13</b> Diagnosing HMC by Comparison of Gradients</a></li>
<li class="chapter" data-level="14" data-path="parallelization.html"><a href="parallelization.html"><i class="fa fa-check"></i><b>14</b> Parallelization</a></li>
<li><a href="cmdstan-tools.html#cmdstan-tools"><i style='font-size: 110%; color:#990017;'>CmdStan Tools</i></a></li>
<li class="chapter" data-level="15" data-path="stanc.html"><a href="stanc.html"><i class="fa fa-check"></i><b>15</b> <code>stanc</code>: Translating Stan to C++</a><ul>
<li class="chapter" data-level="15.1" data-path="stanc.html"><a href="stanc.html#instantiating-the-stanc-binary"><i class="fa fa-check"></i><b>15.1</b> Instantiating the <code>stanc</code> Binary</a></li>
<li class="chapter" data-level="15.2" data-path="stanc.html"><a href="stanc.html#the-stan-compiler-program"><i class="fa fa-check"></i><b>15.2</b> The Stan Compiler Program</a></li>
<li class="chapter" data-level="15.3" data-path="stanc.html"><a href="stanc.html#command-line-options-for-stanc3"><i class="fa fa-check"></i><b>15.3</b> Command-Line Options for stanc3</a></li>
<li class="chapter" data-level="15.4" data-path="stanc.html"><a href="stanc.html#command-line-options-for-stanc2"><i class="fa fa-check"></i><b>15.4</b> Command-Line Options for stanc2</a></li>
<li class="chapter" data-level="15.5" data-path="stanc.html"><a href="stanc.html#using-external-c-code"><i class="fa fa-check"></i><b>15.5</b> Using External C++ Code</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="stansummary.html"><a href="stansummary.html"><i class="fa fa-check"></i><b>16</b> <code>stansummary</code>: MCMC Output Analysis</a><ul>
<li class="chapter" data-level="16.1" data-path="stansummary.html"><a href="stansummary.html#building-the-stansummary-command"><i class="fa fa-check"></i><b>16.1</b> Building the stansummary Command</a></li>
<li class="chapter" data-level="16.2" data-path="stansummary.html"><a href="stansummary.html#running-the-stansummary-program"><i class="fa fa-check"></i><b>16.2</b> Running the <code>stansummary</code> Program</a><ul>
<li class="chapter" data-level="16.2.1" data-path="stansummary.html"><a href="stansummary.html#sampler-parameters"><i class="fa fa-check"></i><b>16.2.1</b> Sampler Parameters</a></li>
<li class="chapter" data-level="16.2.2" data-path="stansummary.html"><a href="stansummary.html#model-parameters-and-quantities-of-interest"><i class="fa fa-check"></i><b>16.2.2</b> Model Parameters and Quantities of Interest</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="stansummary.html"><a href="stansummary.html#command-line-options"><i class="fa fa-check"></i><b>16.3</b> Command-line Options</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="diagnose.html"><a href="diagnose.html"><i class="fa fa-check"></i><b>17</b> <code>diagnose</code>: Diagnosing Biased Hamiltonian Monte Carlo Inferences</a><ul>
<li class="chapter" data-level="17.1" data-path="diagnose.html"><a href="diagnose.html#building-the-diagnose-command"><i class="fa fa-check"></i><b>17.1</b> Building the diagnose Command</a></li>
<li class="chapter" data-level="17.2" data-path="diagnose.html"><a href="diagnose.html#running-the-diagnose-command"><i class="fa fa-check"></i><b>17.2</b> Running the diagnose Command</a></li>
<li class="chapter" data-level="17.3" data-path="diagnose.html"><a href="diagnose.html#diagnose-warnings-and-recommendations"><i class="fa fa-check"></i><b>17.3</b> <code>diagnose</code> Warnings and Recommendations</a><ul>
<li class="chapter" data-level="17.3.1" data-path="diagnose.html"><a href="diagnose.html#divergent-transitions-after-warmup"><i class="fa fa-check"></i><b>17.3.1</b> Divergent transitions after warmup</a></li>
<li class="chapter" data-level="17.3.2" data-path="diagnose.html"><a href="diagnose.html#maximum-treedepth-exceeded"><i class="fa fa-check"></i><b>17.3.2</b> Maximum treedepth exceeded</a></li>
<li class="chapter" data-level="17.3.3" data-path="diagnose.html"><a href="diagnose.html#low-e-bfmi-values---sampler-transitions-hmc-potential-energy."><i class="fa fa-check"></i><b>17.3.3</b> Low E-BFMI values - sampler transitions HMC potential energy.</a></li>
<li class="chapter" data-level="17.3.4" data-path="diagnose.html"><a href="diagnose.html#low-effective-sample-sizes"><i class="fa fa-check"></i><b>17.3.4</b> Low effective sample sizes</a></li>
<li class="chapter" data-level="17.3.5" data-path="diagnose.html"><a href="diagnose.html#high-hatr"><i class="fa fa-check"></i><b>17.3.5</b> High <span class="math inline">\(\hat{R}\)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="print-deprecated-mcmc-output-analysis.html"><a href="print-deprecated-mcmc-output-analysis.html"><i class="fa fa-check"></i><b>18</b> <code>print</code> (deprecated): MCMC Output Analysis</a></li>
<li><a href="appendices.html#appendices"><i style='font-size: 110%; color:#990017;'>Appendices</i></a></li>
<li class="chapter" data-level="19" data-path="stan-csv.html"><a href="stan-csv.html"><i class="fa fa-check"></i><b>19</b> Stan CSV File Format</a><ul>
<li class="chapter" data-level="19.1" data-path="stan-csv.html"><a href="stan-csv.html#csv-column-names-and-order"><i class="fa fa-check"></i><b>19.1</b> CSV Column Names and Order</a></li>
<li class="chapter" data-level="19.2" data-path="stan-csv.html"><a href="stan-csv.html#mcmc-sampler-csv-output"><i class="fa fa-check"></i><b>19.2</b> MCMC Sampler CSV Output</a><ul>
<li class="chapter" data-level="19.2.1" data-path="stan-csv.html"><a href="stan-csv.html#sampler-stan-csv-output-file"><i class="fa fa-check"></i><b>19.2.1</b> Sampler Stan CSV output file</a></li>
<li class="chapter" data-level="19.2.2" data-path="stan-csv.html"><a href="stan-csv.html#diagnostic-csv-output-file"><i class="fa fa-check"></i><b>19.2.2</b> Diagnostic CSV output file</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="stan-csv.html"><a href="stan-csv.html#optimization-output"><i class="fa fa-check"></i><b>19.3</b> Optimization Output</a></li>
<li class="chapter" data-level="19.4" data-path="stan-csv.html"><a href="stan-csv.html#variational-inference-output"><i class="fa fa-check"></i><b>19.4</b> Variational Inference Output</a></li>
<li class="chapter" data-level="19.5" data-path="stan-csv.html"><a href="stan-csv.html#generate-quantities-outputs"><i class="fa fa-check"></i><b>19.5</b> Generate Quantities Outputs</a></li>
<li class="chapter" data-level="19.6" data-path="stan-csv.html"><a href="stan-csv.html#diagnose-method-outputs"><i class="fa fa-check"></i><b>19.6</b> Diagnose Method Outputs</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="json.html"><a href="json.html"><i class="fa fa-check"></i><b>20</b> JSON Format for CmdStan</a><ul>
<li class="chapter" data-level="20.1" data-path="json.html"><a href="json.html#creating-json-files"><i class="fa fa-check"></i><b>20.1</b> Creating JSON Files</a></li>
<li class="chapter" data-level="20.2" data-path="json.html"><a href="json.html#json-syntax-summary"><i class="fa fa-check"></i><b>20.2</b> JSON Syntax Summary</a></li>
<li class="chapter" data-level="20.3" data-path="json.html"><a href="json.html#stan-data-types-in-json-notation"><i class="fa fa-check"></i><b>20.3</b> Stan Data Types in JSON Notation</a><ul>
<li class="chapter" data-level="20.3.1" data-path="json.html"><a href="json.html#empty-arrays-in-json"><i class="fa fa-check"></i><b>20.3.1</b> Empty arrays in JSON</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="rdump.html"><a href="rdump.html"><i class="fa fa-check"></i><b>21</b> RDump Format for CmdStan</a><ul>
<li class="chapter" data-level="21.1" data-path="rdump.html"><a href="rdump.html#creating-dump-files"><i class="fa fa-check"></i><b>21.1</b> Creating Dump Files</a></li>
<li class="chapter" data-level="21.2" data-path="rdump.html"><a href="rdump.html#scalar-variables"><i class="fa fa-check"></i><b>21.2</b> Scalar Variables</a></li>
<li class="chapter" data-level="21.3" data-path="rdump.html"><a href="rdump.html#sequence-variables"><i class="fa fa-check"></i><b>21.3</b> Sequence Variables</a></li>
<li class="chapter" data-level="21.4" data-path="rdump.html"><a href="rdump.html#array-variables"><i class="fa fa-check"></i><b>21.4</b> Array Variables</a></li>
<li class="chapter" data-level="21.5" data-path="rdump.html"><a href="rdump.html#matrix--and-vector-valued-variables"><i class="fa fa-check"></i><b>21.5</b> Matrix- and Vector-Valued Variables</a><ul>
<li class="chapter" data-level="21.5.1" data-path="rdump.html"><a href="rdump.html#vector-dump-format"><i class="fa fa-check"></i><b>21.5.1</b> Vector Dump Format</a></li>
<li class="chapter" data-level="21.5.2" data-path="rdump.html"><a href="rdump.html#matrix-dump-format"><i class="fa fa-check"></i><b>21.5.2</b> Matrix Dump Format</a></li>
<li class="chapter" data-level="21.5.3" data-path="rdump.html"><a href="rdump.html#arrays-of-vectors-and-matrices"><i class="fa fa-check"></i><b>21.5.3</b> Arrays of Vectors and Matrices</a></li>
</ul></li>
<li class="chapter" data-level="21.6" data-path="rdump.html"><a href="rdump.html#integer--and-real-valued-variables"><i class="fa fa-check"></i><b>21.6</b> Integer- and Real-Valued Variables</a><ul>
<li class="chapter" data-level="21.6.1" data-path="rdump.html"><a href="rdump.html#scientific-notation"><i class="fa fa-check"></i><b>21.6.1</b> Scientific Notation</a></li>
<li class="chapter" data-level="21.6.2" data-path="rdump.html"><a href="rdump.html#infinite-and-not-a-number-values"><i class="fa fa-check"></i><b>21.6.2</b> Infinite and Not-a-Number Values</a></li>
</ul></li>
<li class="chapter" data-level="21.7" data-path="rdump.html"><a href="rdump.html#quoted-variable-names"><i class="fa fa-check"></i><b>21.7</b> Quoted Variable Names</a></li>
<li class="chapter" data-level="21.8" data-path="rdump.html"><a href="rdump.html#line-breaks"><i class="fa fa-check"></i><b>21.8</b> Line Breaks</a></li>
<li class="chapter" data-level="21.9" data-path="rdump.html"><a href="rdump.html#bnf-grammar-for-dump-data"><i class="fa fa-check"></i><b>21.9</b> BNF Grammar for Dump Data</a></li>
</ul></li>
<li><a href="bibliography.html#bibliography"><i style='font-size: 110%; color:#990017;'>Bibliography</i></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CmdStan User’s Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">

<div>
This is an old version, <a href="https://mc-stan.org/docs/cmdstan-guide/stanc.html">view current version</a>.
</div>

<div>
This is an old version, <a href="https://mc-stan.org/docs/cmdstan-guide/stanc.html">view current version</a>.
</div>
<div id="stanc" class="section level1">
<h1><span class="header-section-number">15</span> <code>stanc</code>: Translating Stan to C++</h1>
<p>CmdStan translates Stan programs to C++ using the Stan compiler
program which is included in the CmdStan release <code>bin</code> directory as
program <code>stanc</code>.</p>
<p>As of release 2.22, the CmdStan Stan to C++ compiler is written in
OCaml. This compiler is called “stanc3” and has has its own
repository <a href="https://github.com/stan-dev/stanc3" class="uri">https://github.com/stan-dev/stanc3</a>, from which pre-built
binaries for Linux, Mac, and Windows can be downloaded.</p>
<p>Prior to release 2.22, the Stan compiler program was compiled from C++
source code that was part of the core Stan library. This C++ compiler
is still available as program <code>bin/stanc2</code>. This compiler is no
longer being maintained, i.e., existing bugs will not be fixed and new
functions and features are only available in the stanc3 compiler. Its
intended use is as a diagnostic tool and backup for the new stanc3 compiler.
For some future version, it will be dropped from the release altogether.</p>
<div id="instantiating-the-stanc-binary" class="section level2">
<h2><span class="header-section-number">15.1</span> Instantiating the <code>stanc</code> Binary</h2>
<p>Before the Stan compiler can be used, the binary stanc must be
created. This can be done using the makefile as follows. For Mac and
Linux:</p>
<pre><code>make bin/stanc</code></pre>
<p>For Windows:</p>
<pre><code>make bin/stanc.exe</code></pre>
<p>To build the <code>bin/stanc2</code> program, specify:</p>
<pre><code>make bin/stanc2</code></pre>
</div>
<div id="the-stan-compiler-program" class="section level2">
<h2><span class="header-section-number">15.2</span> The Stan Compiler Program</h2>
<p>The Stan compiler program <code>stanc</code> converts Stan programs to C++ concepts.
If the compiler encounters syntax errors in the program,
it will provide an error message indicating the location
in the input where the failure occurred and reason for the failure.
The following example illustrates a fully qualified call to stanc to
generate the C++ translation of the example model <code>bernoulli.stan</code>.
For Linux and Mac:</p>
<pre><code>&gt; cd &lt;cmdstan-home&gt;
&gt; bin/stanc --o=bernoulli.hpp examples/bernoulli/bernoulli.stan</code></pre>
<p>For Windows:</p>
<pre><code>&gt; cd &lt;cmdstan-home&gt;
&gt; bin/stanc.exe --o=bernoulli.hpp examples/bernoulli/bernoulli.stan</code></pre>
<p>The base name of the Stan program file determines the name of the C++ model class.
Because this name is the name of a C++ class, it must
start with an alphabetic character (<code>a--z</code> or <code>A--Z</code>) and
contain only alphanumeric characters (<code>a--z</code>, <code>A--Z</code>, and
<code>0--9</code>) and underscores (<code>_</code>) and should not conflict with
any C++ reserved keyword.</p>
<p>The C++ code implementing the class is written to the file
<code>bernoulli.hpp</code> in the current directory. The final argument,
<code>bernoulli.stan</code>, is the file from which to read the Stan
program.</p>
<p>In practice, stanc is invoked indirectly, via the GNU Make utility,
which contains rules that compile a Stan program to its corresponding
executable. To build the simple Bernoulli model via <code>make</code>, we specify
the name of the target executable file.
On Mac and Linux, this is the name of the Stan program with the <code>.stan</code>
omitted. On Windows, replace <code>.stan</code> with <code>.exe</code>, and make
sure that the path is given with slashes and not backslashes.
For Linux and Mac:</p>
<pre><code>&gt; make examples/bernoulli/bernoulli</code></pre>
<p>For Windows:</p>
<pre><code>&gt; make examples/bernoulli/bernoulli.exe</code></pre>
<p>The makefile rules first invoke the stanc compiler to translate the
Stan model to C++ , then compiles and links the C++ code to a binary
executable. The makefile variable <code>STANCFLAGS</code> can be used to to
override the default arguments to stanc, e.g.,</p>
<pre><code>&gt; make STANCFLAGS=&quot;--include-paths=~/foo&quot; examples/bernoulli/bernoulli</code></pre>
<p>To use the stanc2 compiler instead of the stanc3 compiler, set the
make option <code>STANC2</code>:</p>
<pre><code>&gt; make STANC2=TRUE examples/bernoulli/bernoulli</code></pre>
</div>
<div id="command-line-options-for-stanc3" class="section level2">
<h2><span class="header-section-number">15.3</span> Command-Line Options for stanc3</h2>
<p>The stanc3 compiler has the following command-line syntax:</p>
<pre><code>&gt; stanc (options) &lt;model_file&gt;</code></pre>
<p>where <code>&lt;model_file&gt;</code> is a path to a Stan model
file ending in suffix <code>.stan</code>.</p>
<p>The stanc3 options are:</p>
<ul>
<li><p><code>--help</code> - Displays the complete list of stanc3 options, then exits.</p></li>
<li><p><code>--version</code> - Display stanc version number</p></li>
<li><p><code>--name=&lt;model_name&gt;</code> - Specify the name of the class
used for the implementation of the Stan model in the generated C++ code.</p></li>
<li><p><code>--o=&lt;file_name&gt;</code> - Specify the name of the file into
which the generated C++ is written.</p></li>
<li><p><code>--allow-undefined</code> - Do not throw a parser error
if there is a function in the Stan program
that is declared but not defined in the functions block.</p></li>
<li><p><code>--include_paths=&lt;dir1,...dirN&gt;</code> - Takes a comma-separated list
of directories that may contain a file in an <code>#include</code> directive.</p></li>
<li><p><code>--use-opencl</code> - If set, will use additional Stan OpenCL
features enabled in the Stan-to-C++ compiler.</p></li>
<li><p><code>--auto-format</code> - Pretty prints the program to the console.</p></li>
<li><p><code>--print-canonical</code> - Prints the canonicalized program to the console.</p></li>
<li><p><code>--print-cpp</code> - If set, output the generated C++ Stan model class to stdout.</p></li>
<li><p><code>--O</code> - Allow the compiler to apply all optimizations to the Stan
code. <strong>WARNING:</strong> <em>This is currently an experimental feature!</em></p></li>
<li><p><code>--warn-uninitialized</code> - Emit warnings about uninitialized variables
to stderr. Currently an experimental feature.</p></li>
</ul>
<p>The compiler also provides a number of debug options which are
primarily of interest to stanc3 developers; use the <code>--help</code>
option to see the full set.</p>
</div>
<div id="command-line-options-for-stanc2" class="section level2">
<h2><span class="header-section-number">15.4</span> Command-Line Options for stanc2</h2>
<p>The stanc2 compiler has the same command-line syntax as the
stanc3 compiler, but has fewer options:</p>
<ul>
<li><p><code>--help</code> - Displays the complete list of stanc3 options, then exits.</p></li>
<li><p><code>--version</code> - Display stanc version number</p></li>
<li><p><code>--name=&lt;model_name&gt;</code> - Specify the name of the class
used for the implementation of the Stan model in the generated C++ code.</p></li>
<li><p><code>--o=&lt;file_name&gt;</code> - Specify the name of the file into
which the generated C++ is written.</p></li>
<li><p><code>--allow_undefined</code> - Do not throw a parser error
if there is a function in the Stan program
that is declared but not defined in the functions block.</p></li>
<li><p><code>--include_paths=&lt;dir1,...dirN&gt;</code> - Takes a comma-separated list
of directories that may contain a file in an <code>#include</code> directive.</p></li>
</ul>
</div>
<div id="using-external-c-code" class="section level2">
<h2><span class="header-section-number">15.5</span> Using External C++ Code</h2>
<p>The <code>--allow_undefined</code> flag can be passed to the call to stanc,
which will allow undefined functions in the Stan language to be parsed
without an error. We can then include a definition of the function in
a C++ header file.
This requires specifying two makefile variables:
- <code>STANCFLAGS=--allow_undedefined</code>
- <code>USER_HEADER=&lt;header_file.hpp&gt;</code>, where <code>&lt;header_file.hpp&gt;</code> is the name of a header file that
defines a function with the same name and signature in a namespace
that is formed by concatenating the <code>class_name</code> argument to
stanc documented above to the string <code>_namespace</code></p>
<p>As an example, consider the following variant of the Bernoulli example</p>
<pre><code>functions {
       real make_odds(real theta);
}
data {
       int&lt;lower=0&gt; N;
       int&lt;lower=0,upper=1&gt; y[N];
     }
     parameters {
       real&lt;lower=0,upper=1&gt; theta;
}
model {
       theta ~ beta(1,1);  // uniform prior on interval 0,1
       y ~ bernoulli(theta);
     }
     generated quantities {
       real odds;
       odds = make_odds(theta);
}</code></pre>
<p>Here the <code>make_odds</code> function is declared but not defined, which
would ordinarily result in a parser error. However, if you put
<code>STANCFLAGS = --allow_undefined</code> into the <code>make/local</code> file
or into the <code>stanc</code> call, then the stanc compiler will translate
this program to C++, but the generated C++ code will not compile
unless you write a file
such as <code>examples/bernoulli/make_odds.hpp</code> with the following lines</p>
<pre><code>namespace bernoulli_model_namespace {
          template &lt;typename T0__&gt;  inline  typename
          boost::math::tools::promote_args&lt;T0__&gt;::type  make_odds(const T0__&amp;
theta, std::ostream* pstream__) {
       return theta / (1 - theta);  }
       }</code></pre>
<p>Given the above, the following <code>make</code> invocation should work</p>
<pre><code>&gt; make STANCFLAGS=--allow_undefined USER_HEADER=examples/bernoulli/make_odds.hpp examples/bernoulli/bernoulli # on Windows add .exe</code></pre>
<p>Alternatively, you could put <code>STANCFLAGS</code> and <code>USER_HEADER</code> into the
<code>make/local</code> file instead of specifying them on the command-line.</p>
<p>If the function were more complicated and involved functions in the
Stan Math Library, then you would need to prefix the function calls
with <code>stan::math::</code> The <code>pstream__</code> argument is mandatory
in the signature but need not be used if your function does not print
any output. To see the necessary boilerplate look at the corresponding
lines in the generated C++ file.</p>
<p>For more details about how to write C++ code using the Stan Math
Library, see <a href="https://arxiv.org/abs/1509.07164" class="uri">https://arxiv.org/abs/1509.07164</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cmdstan-tools.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stansummary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true,
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
