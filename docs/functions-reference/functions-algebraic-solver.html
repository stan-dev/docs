<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Stan Functions Reference</title>
  <meta name="description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Stan Functions Reference" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Stan Functions Reference" />
  
  <meta name="twitter:description" content="Reference for the functions defined in the Stan math library and available in the Stan programming language." />
  

<meta name="author" content="Stan Development Team">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="higher-order-functions.html">
<link rel="next" href="functions-ode-solver.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="../stan-manual.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li style="font-size:110%; font-weight:400; font-family: Verdana, Helvetica, sans; line-height:1.4; margin: 0.5em 0 0 1em">Stan Functions Reference</li>

<li class="divider"></li>
<li><a href="index.html#overview"><i style="font-size: 110%; padding:1.5em 0 0 0; color:#990017;">Overview</i></a></li>
<li><a href="built-in-functions.html#built-in-functions"><i style="font-size: 110%; color:#990017;">Built-In Functions</i></a></li>
<li class="chapter" data-level="1" data-path="void-functions.html"><a href="void-functions.html"><i class="fa fa-check"></i><b>1</b> Void Functions</a></li>
<li class="chapter" data-level="2" data-path="integer-valued-basic-functions.html"><a href="integer-valued-basic-functions.html"><i class="fa fa-check"></i><b>2</b> Integer-Valued Basic Functions</a></li>
<li class="chapter" data-level="3" data-path="real-valued-basic-functions.html"><a href="real-valued-basic-functions.html"><i class="fa fa-check"></i><b>3</b> Real-Valued Basic Functions</a></li>
<li class="chapter" data-level="4" data-path="array-operations.html"><a href="array-operations.html"><i class="fa fa-check"></i><b>4</b> Array Operations</a></li>
<li class="chapter" data-level="5" data-path="matrix-operations.html"><a href="matrix-operations.html"><i class="fa fa-check"></i><b>5</b> Matrix Operations</a></li>
<li class="chapter" data-level="6" data-path="sparse-matrices.html"><a href="sparse-matrices.html"><i class="fa fa-check"></i><b>6</b> Sparse Matrix Operations</a></li>
<li class="chapter" data-level="7" data-path="mixed-operations.html"><a href="mixed-operations.html"><i class="fa fa-check"></i><b>7</b> Mixed Operations</a></li>
<li class="chapter" data-level="8" data-path="compound-arithmetic-and-assignment.html"><a href="compound-arithmetic-and-assignment.html"><i class="fa fa-check"></i><b>8</b> Compound Arithmetic and Assignment</a></li>
<li class="chapter" data-level="9" data-path="higher-order-functions.html"><a href="higher-order-functions.html"><i class="fa fa-check"></i><b>9</b> Higher-Order Functions</a></li>
<li><a href="discrete-distributions.html#discrete-distributions"><i style="font-size: 110%; color:#990017;">Discrete Distributions</i></a></li>
<li class="chapter" data-level="10" data-path="conventions-for-probability-functions.html"><a href="conventions-for-probability-functions.html"><i class="fa fa-check"></i><b>10</b> Conventions for Probability Functions</a></li>
<li class="chapter" data-level="11" data-path="binary-distributions.html"><a href="binary-distributions.html"><i class="fa fa-check"></i><b>11</b> Binary Distributions</a></li>
<li class="chapter" data-level="12" data-path="bounded-discrete-distributions.html"><a href="bounded-discrete-distributions.html"><i class="fa fa-check"></i><b>12</b> Bounded Discrete Distributions</a></li>
<li class="chapter" data-level="13" data-path="unbounded-discrete-distributions.html"><a href="unbounded-discrete-distributions.html"><i class="fa fa-check"></i><b>13</b> Unbounded Discrete Distributions</a></li>
<li class="chapter" data-level="14" data-path="multivariate-discrete-distributions.html"><a href="multivariate-discrete-distributions.html"><i class="fa fa-check"></i><b>14</b> Multivariate Discrete Distributions</a></li>
<li><a href="continuous-distributions.html#continuous-distributions"><i style="font-size: 110%; color:#990017;">Continuous Distributions</i></a></li>
<li class="chapter" data-level="15" data-path="unbounded-continuous-distributions.html"><a href="unbounded-continuous-distributions.html"><i class="fa fa-check"></i><b>15</b> Unbounded Continuous Distributions</a></li>
<li class="chapter" data-level="16" data-path="positive-continuous-distributions.html"><a href="positive-continuous-distributions.html"><i class="fa fa-check"></i><b>16</b> Positive Continuous Distributions</a></li>
<li class="chapter" data-level="17" data-path="non-negative-continuous-distributions.html"><a href="non-negative-continuous-distributions.html"><i class="fa fa-check"></i><b>17</b> Non-negative Continuous Distributions</a></li>
<li class="chapter" data-level="18" data-path="positive-lower-bounded-probabilities.html"><a href="positive-lower-bounded-probabilities.html"><i class="fa fa-check"></i><b>18</b> Positive Lower-Bounded Probabilities</a></li>
<li class="chapter" data-level="19" data-path="continuous-distributions-on-0-1.html"><a href="continuous-distributions-on-0-1.html"><i class="fa fa-check"></i><b>19</b> Continuous Distributions on [0, 1]</a></li>
<li class="chapter" data-level="20" data-path="circular-distributions.html"><a href="circular-distributions.html"><i class="fa fa-check"></i><b>20</b> Circular Distributions</a></li>
<li class="chapter" data-level="21" data-path="bounded-continuous-probabilities.html"><a href="bounded-continuous-probabilities.html"><i class="fa fa-check"></i><b>21</b> Bounded Continuous Probabilities</a></li>
<li class="chapter" data-level="22" data-path="distributions-over-unbounded-vectors.html"><a href="distributions-over-unbounded-vectors.html"><i class="fa fa-check"></i><b>22</b> Distributions over Unbounded Vectors</a></li>
<li class="chapter" data-level="23" data-path="simplex-distributions.html"><a href="simplex-distributions.html"><i class="fa fa-check"></i><b>23</b> Simplex Distributions</a></li>
<li class="chapter" data-level="24" data-path="correlation-matrix-distributions.html"><a href="correlation-matrix-distributions.html"><i class="fa fa-check"></i><b>24</b> Correlation Matrix Distributions</a></li>
<li class="chapter" data-level="25" data-path="covariance-matrix-distributions.html"><a href="covariance-matrix-distributions.html"><i class="fa fa-check"></i><b>25</b> Covariance Matrix Distributions</a></li>
<li><a href="appendix.html#appendix"><i style="font-size: 110%; color:#990017;">Appendix</i></a></li>
<li class="chapter" data-level="26" data-path="math-functions.html"><a href="math-functions.html"><i class="fa fa-check"></i><b>26</b> Mathematical Functions</a></li>
<li><a href="references.html#references"><i style="font-size: 110%; color:#990017;">References</i></a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Stan Functions Reference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions-algebraic-solver" class="section level2">
<h2><span class="header-section-number">9.1</span> Algebraic Equation Solver</h2>
<p>Stan provides a built-in algebraic equation solver. Although it looks
like other function applications, the algebraic solver is special in
two ways.</p>
<p>First, the algebraic solver is a higher-order function, i.e. it takes
another function as one of its arguments. The only other functions in
Stan which share this feature are the ordinary differential equation
solvers (see section <a href="functions-ode-solver.html#functions-ode-solver">9.2</a>). Ordinary Stan
functions do not allow functions as arguments.</p>
<p>Second, some of the arguments of the algebraic solvers are restricted
to data only expressions. These expressions must not contain variables
other than those declared in the data or transformed data blocks.
Ordinary Stan functions place no restriction on the origin of
variables in their argument expressions.</p>
<div id="specifying-an-algebraic-equation-as-a-function" class="section level3">
<h3><span class="header-section-number">9.1.1</span> Specifying an Algebraic Equation as a Function</h3>
<p>An algebraic system is specified as an ordinary function in Stan
within the function block. The algebraic system function must have
this signature:</p>
<pre><code> vector algebra_system(vector y, vector theta,
                              real[] x_r, int[] x_i)</code></pre>
<p>The algebraic system function should return the value of the algebraic
function which goes to 0, when we plug in the solution to the
algebraic system.</p>
<p>The argument of this function are:</p>
<ul>
<li><p><em><code>y</code></em>, the unknowns we wish to solve for</p></li>
<li><p><em><code>theta</code></em>, parameter values used to evaluate the algebraic system</p></li>
<li><p><em><code>x_r</code></em>, data values used to evaluate the algebraic system</p></li>
<li><p><em><code>x_i</code></em>, integer data used to evaluate the algebraic system</p></li>
</ul>
<p>The algebraic system function separates parameter values, <em><code>theta</code></em>,
from data values, <em><code>x_r</code></em>, for efficiency in computing the gradients
of the algebraic system.</p>
</div>
<div id="call-to-the-algebraic-solver" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Call to the Algebraic Solver</h3>
<!-- vector; algebra_solver; (function algebra_system, vector y_guess, vector theta, real[] x_r, int[] x_i); -->
<p></p>
<p><code>vector</code> <strong><code>algebra_solver</code></strong><code>(function algebra_system, vector y_guess, vector theta, real[] x_r, int[] x_i)</code><br>
Solves the algebraic system, given an initial guess, using the Powell
hybrid algorithm.</p>
<!-- vector; algebra_solver; (function algebra_system, vector y_guess, vector theta, real[] x_r, int[] x_i, real rel_tol, real f_tol, int max_steps); -->
<p></p>
<p><code>vector</code> <strong><code>algebra_solver</code></strong><code>(function algebra_system, vector y_guess, vector theta, real[] x_r, int[] x_i, real rel_tol, real f_tol, int max_steps)</code><br>
Solves the algebraic system, given an initial guess, using the Powell
hybrid algorithm with additional control parameters for the solver.</p>
<div id="arguments-to-the-algebraic-solver" class="section level4">
<h4><span class="header-section-number">9.1.2.1</span> Arguments to the Algebraic Solver</h4>
<p>The arguments to the algebraic solver are as follows:</p>
<ul>
<li><em><code>algebra_system</code></em>: function literal referring to a function
specifying the system of algebraic equations with signature
<code>(vector, vector, real[], int[]):vector</code>. The arguments represent</li>
</ul>
<ol style="list-style-type: decimal">
<li>unknowns, (2) parameters, (3) real data, and (4) integer data,
and the return value contains the value of the algebraic function,
which goes to 0 when we plug in the solution to the algebraic system,</li>
</ol>
<ul>
<li><p><em><code>y_guess</code></em>: initial guess for the solution, type <code>vector</code>,</p></li>
<li><p><em><code>theta</code></em>: parameters only, type <code>vector</code>,</p></li>
<li><p><em><code>x_r</code></em>: real data only, type <code>real[]</code>, and</p></li>
<li><p><em><code>x_i</code></em>: integer data only, type <code>int[]</code>.</p></li>
</ul>
<p>For more fine-grained control of the algebraic solver, these
parameters can also be provided:</p>
<ul>
<li><p><em><code>rel_tol</code></em>: relative tolerance for the algebraic solver, type
<code>real</code>, data only,</p></li>
<li><p><em><code>function_tol</code></em>: function tolerance for the algebraic solver,
type <code>real</code>, data only,</p></li>
<li><p><em><code>max_num_steps</code></em>: maximum number of steps to take in the
algebraic solver, type <code>int</code>, data only.</p></li>
</ul>
</div>
<div id="return-value" class="section level4">
<h4><span class="header-section-number">9.1.2.2</span> Return value</h4>
<p>The return value for the algebraic solver is an object of type
<code>vector</code>, with values which, when plugged in as <code>y</code> make the algebraic
function go to 0.</p>
</div>
<div id="sizes-and-parallel-arrays" class="section level4">
<h4><span class="header-section-number">9.1.2.3</span> Sizes and parallel arrays</h4>
<p>Certain sizes have to be consistent. The initial guess, return value
of the solver, and return value of the algebraic function must all be
the same size.</p>
<p>The parameters, real data, and integer data will be passed from the
solver directly to the system function.</p>
</div>
<div id="algorithmic-details" class="section level4">
<h4><span class="header-section-number">9.1.2.4</span> Algorithmic details</h4>
<p>The algebraic solver uses the Powell hybrid method <span class="citation">(Powell <a href="#ref-Powell:1970">1970</a>)</span>,
which in turn uses first-order derivatives. The Stan code builds on
the implementation of the hybrid solver in the unsupported module for
nonlinear optimization problems of the Eigen library <span class="citation">(Guennebaud, Jacob, and others <a href="#ref-Eigen:2013">2010</a>)</span>.
This solver is in turn based on the algorithm developed for the
package MINPACK-1 <span class="citation">(Jorge J. More <a href="#ref-minpack:1980">1980</a>)</span>.</p>
<p>The Jacobian of the solution with respect to auxiliary parameters is
computed using the implicit function theorem. Intermediate Jacobians
(of the the algebraic function’s output with respect to the unknowns y
and with respect to the auxiliary parameters theta) are computed using
Stan’s automatic differentiation.</p>
</div>
</div>
</div>
<h3><i style="font-size: 110%; color:#990017;">References</i></h3>
<div id="refs" class="references">
<div id="ref-Powell:1970">
<p>Powell, Michael J. D. 1970. “A Hybrid Method for Nonlinear Equations.” In <em>Numerical Methods for Nonlinear Algebraic Equations</em>, edited by P. Rabinowitz. Gordon; Breach.</p>
</div>
<div id="ref-Eigen:2013">
<p>Guennebaud, Gaël, Benoît Jacob, and others. 2010. “Eigen V3.” http://eigen.tuxfamily.org.</p>
</div>
<div id="ref-minpack:1980">
<p>Jorge J. More, Kenneth E. Hillstrom, Burton S. Garbow. 1980. <em>User Guide for Minpack-1</em>. 9700 South Cass Avenue, Argonne, Illinois 60439: Argonne National Laboratory.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="higher-order-functions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions-ode-solver.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": null,
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true,
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
